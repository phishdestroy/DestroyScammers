let DATA={emails:[],stats:{}},filtered=[],page=1;const perPage=20;let currentFilter="all",searchQuery="",currentView="dashboard",selectedActor=null;function getVTArray(e){return e.virustotal?Array.isArray(e.virustotal)?e.virustotal.filter((e=>e.malicious>0||e.suspicious>0)):Object.entries(e.virustotal).filter((([e,n])=>n&&n.found&&(n.malicious>0||n.suspicious>0))).map((([e,n])=>({domain:e,...n}))):[]}function getThreatCount(e){getBLArray(e).filter((e=>e.blacklisted)).length,getVTArray(e).length;const n=new Set(getBLArray(e).filter((e=>e.blacklisted)).map((e=>e.domain))),a=new Set(getVTArray(e).map((e=>e.domain)));return new Set([...n,...a]).size}function getBLArray(e){return e.blacklist?Array.isArray(e.blacklist)?e.blacklist:Object.entries(e.blacklist).filter((([e,n])=>n&&(n.blacklisted||n.brand_impersonation?.length))).map((([e,n])=>({domain:e,...n}))):[]}function getBrandArray(e){const n=new Set;if(!e.blacklist)return[];return(Array.isArray(e.blacklist)?e.blacklist:Object.entries(e.blacklist).map((([e,n])=>({domain:e,...n})))).forEach((e=>{(e.brand_impersonation||[]).forEach((e=>n.add(e)))})),[...n]}function hasLeakData(e){return e.passwords?.length>0||e.leak_info?.num_results>0||e.leak_extended?.databases?.length>0||e.stats?.leak_count>0||e.leaks?.length>0&&e.leaks.some((e=>e.source))}function getLeakCount(e){let n=0;return n+=e.passwords?.length||0,n+=e.leak_info?.num_results||0,n+=e.leak_extended?.databases?.length||0,n}function getPasswordCount(e){return e.passwords?.length||0}function getActorScreenshots(e){const n=[],a=new Set;return(e.domain_cards||[]).forEach((e=>{e.screenshot&&!a.has(e.screenshot)&&(a.add(e.screenshot),n.push(e))})),e.urlscan&&"object"==typeof e.urlscan&&Object.entries(e.urlscan).forEach((([e,s])=>{s.screenshot&&!a.has(s.screenshot)&&(a.add(s.screenshot),n.push({domain:e,screenshot:s.screenshot,...s}))})),n}const ICONS={malware:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',phishing:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',domain:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>',email:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>',phone:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>',user:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',key:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>',leak:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></svg>',ip:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>',brand:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>',crypto:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',android:'<svg class="icon" viewBox="0 0 24 24" fill="#3DDC84"><path d="M17.532 15.106a1.003 1.003 0 1 1-.001-2.007 1.003 1.003 0 0 1 .001 2.007zm-11.063 0a1.003 1.003 0 1 1-.001-2.007 1.003 1.003 0 0 1 .001 2.007zm11.371-4.453l1.977-3.424a.416.416 0 0 0-.152-.567.416.416 0 0 0-.567.152l-2.003 3.469a12.013 12.013 0 0 0-5.09-1.123c-1.857 0-3.596.4-5.09 1.123L4.91 6.814a.416.416 0 0 0-.567-.152.416.416 0 0 0-.152.567l1.977 3.424A11.51 11.51 0 0 0 .5 18.094h23C23.5 14.848 21.107 12.063 17.84 10.653z"/></svg>',metamask:'<svg class="icon" viewBox="0 0 24 24"><path fill="#E2761B" d="M21.87 3.34L13.5 9.54l1.54-3.64 6.83-2.56z"/><path fill="#E4761B" d="M2.13 3.34l8.29 6.28-1.46-3.72-6.83-2.56z"/><path fill="#E4761B" d="M18.71 16.87l-2.23 3.42 4.77 1.31 1.37-4.64-3.91-.09z"/><path fill="#E4761B" d="M1.39 17l1.36 4.64 4.77-1.31-2.23-3.42L1.39 17z"/></svg>',virustotal:'<svg class="icon" viewBox="0 0 24 24"><path fill="#394EFF" d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>',seal:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>',screenshot:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>',link:'<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',external:'<svg class="icon icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>',google:'<svg class="icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>'};async function init(){setupNav(),setupSearch(),await loadData()}function setupNav(){document.querySelectorAll(".nav-item").forEach((e=>{e.addEventListener("click",(()=>switchView(e.dataset.view)))}))}function setupSearch(){const e=document.getElementById("search-input");if(!e)return;let n=document.createElement("div");n.className="search-dropdown",n.id="search-dropdown",e.parentElement.appendChild(n);let a=[];const s=()=>{a=[],DATA.emails.forEach((e=>{a.push({type:"email",value:e.email,actor:e}),(e.domains||[]).forEach((n=>{a.push({type:"domain",value:n,actor:e})})),(e.leak_intel?.real_names||[]).forEach((n=>{a.push({type:"name",value:n,actor:e})})),(e.leak_intel?.phones||[]).map((e=>e.phone||e)).forEach((n=>{a.push({type:"phone",value:n,actor:e})}))}))},t=s=>{if(!s||s.length<2)return n.innerHTML="",void n.classList.remove("active");const t=s.toLowerCase(),i=a.filter((e=>e.value.toLowerCase().includes(t))).slice(0,15);if(!i.length)return n.innerHTML='<div class="search-no-results">No results found</div>',void n.classList.add("active");const o={email:[],domain:[],name:[],phone:[]};i.forEach((e=>o[e.type]?.push(e)));let r="";const l={email:"üìß Emails",domain:"üåê Domains",name:"üë§ Names",phone:"üìû Phones"};Object.entries(o).forEach((([e,n])=>{n.length&&(r+=`<div class="search-group-label">${l[e]}</div>`,n.slice(0,5).forEach((e=>{const n=e.value.replace(new RegExp(`(${t})`,"gi"),"<mark>$1</mark>");r+=`<div class="search-item" data-email="${esc(e.actor.email)}">\n                    <span class="search-value">${n}</span>\n                    <span class="search-actor">${esc(e.actor.email)}</span>\n                </div>`})))})),n.innerHTML=r,n.classList.add("active"),n.querySelectorAll(".search-item").forEach((a=>{a.addEventListener("click",(()=>{const s=a.dataset.email;e.value=s,searchQuery=s.toLowerCase(),n.classList.remove("active"),page=1,applyFilters(),openProfile(s)}))}))};e.addEventListener("input",debounce((e=>{const n=e.target.value.trim();DATA.emails.length&&!a.length&&s(),t(n),searchQuery=n.toLowerCase(),page=1,applyFilters()}),200)),e.addEventListener("focus",(()=>{e.value.length>=2&&t(e.value)})),e.addEventListener("blur",(()=>{setTimeout((()=>n.classList.remove("active")),200)})),e.addEventListener("keydown",(e=>{"Escape"===e.key&&n.classList.remove("active")}));const i=loadData;window.loadDataWithIndex=async()=>{await i(),s()},document.querySelectorAll(".chip").forEach((e=>{e.addEventListener("click",(()=>{document.querySelectorAll(".chip").forEach((e=>e.classList.remove("active"))),e.classList.add("active"),currentFilter=e.dataset.filter,page=1,applyFilters()}))}))}function switchView(e){currentView=e,document.querySelectorAll(".nav-item").forEach((n=>n.classList.toggle("active",n.dataset.view===e))),document.querySelectorAll(".view").forEach((e=>e.classList.remove("active")));const n=document.getElementById(`${e}-view`);n&&(n.classList.add("active"),n.style.animation="none",n.offsetHeight,n.style.animation="fadeInUp 0.4s var(--ease-out)"),!filtered.length&&DATA.emails?.length&&(filtered=[...DATA.emails]),"dashboard"===e?renderDashboard():"actors"===e?(page=1,renderActors()):"threats"===e?renderThreats():"graph"===e&&renderGraph()}async function loadData(){try{const[e,n]=await Promise.all([fetch("data/data.json"),fetch("data/registrants.json").catch((()=>null))]);if(DATA=await e.json(),n&&n.ok)try{const e=await n.json(),a={};e.forEach((e=>{a[e.actor]||(a[e.actor]=[]),a[e.actor].push(e)})),DATA.emails.forEach((e=>{a[e.email]&&(e.registrants=a[e.email])})),DATA.registrants=e}catch(e){console.warn("Could not parse registrants:",e)}DATA.emails.forEach((e=>{e.threat_score=calcThreatScore(e),e.intel_score=calcIntelScore(e)})),updateStats(),applyFilters(),renderDashboard()}catch(e){console.error("Load error:",e)}}function calcThreatScore(e){let n=0;return n+=100*getVTArray(e).length,n+=80*getBLArray(e).length,n+=50*getBrandArray(e).length,n+=30*(e.crypto_indicators?.length||0),n}function calcIntelScore(e){let n=0;return e.google?.person_id&&(n+=50),e.google?.photo&&(n+=30),e.google?.name&&(n+=20),n+=40*(e.leak_intel?.real_names?.length||0),n+=35*(e.leak_intel?.phones?.length||0),n+=25*(e.leak_intel?.ips?.length||0),e.leak_info?.fullname&&(n+=40),e.leak_info?.phone&&(n+=35),e.leak_info?.nickname&&(n+=15),n+=10*(e.leak_info?.num_results||0),n+=25*(e.passwords?.length||0),n+=15*(e.contacts?.length||0),n+=30*(e.leak_extended?.databases?.length||0),n+=20*(e.whois_records?.filter((e=>e.name&&!e.name.includes("REDACTED")&&!e.name.includes("???"))).length||0),n}function updateStats(){const e=DATA.stats||{};let n=0,a=0,s=0,t=0,i=0,o=0,r=new Set;(DATA.emails||[]).forEach((e=>{n+=getBrandArray(e).length,hasLeakData(e)&&a++,s+=getPasswordCount(e),t+=getBLArray(e).filter((e=>e.blacklisted)).length,i+=getThreatCount(e),o+=e.total_domains||e.domains?.length||0,(e.registrars||[]).forEach((e=>{const n="object"==typeof e?e.name:e;n&&"????????????"!==n&&!n.includes("REDACTED")&&r.add(n)})),(e.whois_records||[]).forEach((e=>{e.registrar&&"????????????"!==e.registrar&&!e.registrar.includes("REDACTED")&&r.add(e.registrar)}))})),animateNumber("stat-actors",DATA.emails?.length||e.total_emails),animateNumber("stat-domains",o||e.total_domains),animateNumber("stat-threats",i),animateNumber("stat-registrars",r.size),animateNumber("pill-phishing",t||e.blacklisted||0),animateNumber("pill-malware",i||t||e.malicious_domains||0),animateNumber("pill-brand",n),animateNumber("pill-leaks",a+s)}function animateNumber(e,n){const a=document.getElementById(e);if(!a)return;const s=parseInt(a.textContent.replace(/,/g,""))||0,t=performance.now();requestAnimationFrame((function e(i){const o=i-t,r=Math.min(o/1e3,1),l=1-Math.pow(1-r,3),c=Math.round(s+(n-s)*l);a.textContent=fmt(c),r<1&&requestAnimationFrame(e)}))}function applyFilters(){let e=[...DATA.emails||[]];searchQuery&&(e=e.filter((e=>[e.email,...e.domains||[],...e.leak_intel?.real_names||[],...e.leak_intel?.phones?.map((e=>e.phone))||[],...e.contacts?.map((e=>e.name))||[]].join(" ").toLowerCase().includes(searchQuery)))),"all"!==currentFilter&&(e=e.filter((e=>{switch(currentFilter){case"phishing":return getBLArray(e).length>0;case"malware":return getVTArray(e).length>0;case"brand":return getBrandArray(e).length>0;case"leaks":return hasLeakData(e);default:return!0}}))),e.sort(((e,n)=>n.threat_score+n.intel_score-(e.threat_score+e.intel_score))),filtered=e,"actors"===currentView?renderActors():"threats"===currentView&&renderThreats()}document.addEventListener("DOMContentLoaded",init),window.switchView=switchView;const HIGH_VALUE_BRANDS=["metamask","ledger","trezor","coinbase","binance","phantom","trustwallet","exodus","paypal","chase","bank"];function hasCryptoBrand(e){return getBrandArray(e).map((e=>e.toLowerCase())).some((e=>HIGH_VALUE_BRANDS.some((n=>e.includes(n)))))}function renderDashboard(){const e=DATA.stats||{};let n=0,a=0,s=0,t=0,i=0,o=0,r=new Set;(DATA.emails||[]).forEach((e=>{n+=getBrandArray(e).length,hasLeakData(e)&&a++,s+=getPasswordCount(e),t+=getBLArray(e).filter((e=>e.blacklisted)).length,i+=getThreatCount(e),o+=e.total_domains||e.domains?.length||0,(e.registrars||[]).forEach((e=>{const n="object"==typeof e?e.name:e;n&&"????????????"!==n&&!n.includes("REDACTED")&&r.add(n)})),(e.whois_records||[]).forEach((e=>{e.registrar&&"????????????"!==e.registrar&&!e.registrar.includes("REDACTED")&&r.add(e.registrar)}))})),animateNumber("dash-actors",DATA.emails?.length||e.total_emails),animateNumber("dash-domains",o||e.total_domains),animateNumber("dash-phishing",t||e.blacklisted),animateNumber("dash-malware",i||e.malicious_domains),animateNumber("dash-registrars",r.size),animateNumber("dash-brand",n),animateNumber("dash-leaks",a+s),animateNumber("dash-passwords",s||e.total_passwords);const l=DATA.emails.filter((e=>e.threat_score>0||getBrandArray(e).length>0)).sort(((e,n)=>{const a=hasCryptoBrand(e)?500:0,s=hasCryptoBrand(n)?500:0,t=a+100*getBrandArray(e).length+e.threat_score+e.intel_score;return s+100*getBrandArray(n).length+n.threat_score+n.intel_score-t})).slice(0,6),c=document.getElementById("critical-threats");c&&(c.innerHTML=l.length?l.map((e=>renderThreatCard(e))).join(""):'<div class="empty-text">No critical threats with identified actors</div>');const d=DATA.emails.filter((e=>e.intel_score>50)).sort(((e,n)=>n.intel_score-e.intel_score)).slice(0,6),p=document.getElementById("top-actors");p&&(p.innerHTML=d.length?d.map((e=>renderActorPreview(e))).join(""):'<div class="empty-text">No identified actors</div>')}function renderThreatCard(e){const n=e.leak_intel?.real_names?.[0]||e.google?.name||"",a=getActorCountry(e),s=getVTArray(e),t=getBLArray(e),i=getBrandArray(e),o=hasCryptoBrand(e),r=[];if(o){const e=i.filter((e=>HIGH_VALUE_BRANDS.some((n=>e.toLowerCase().includes(n)))));r.push(`<span class="threat-tag crypto">üí∞ ${e.slice(0,2).join(", ")}</span>`)}s.length&&r.push(`<span class="threat-tag malware">${ICONS.malware} ${s.length} Malware</span>`),t.length&&r.push(`<span class="threat-tag phishing">${ICONS.phishing} ${t.length} Phishing</span>`),i.length&&!o&&r.push(`<span class="threat-tag brand">${ICONS.brand} ${i.slice(0,2).join(", ")}</span>`);let l=e.domain_cards?.find((e=>e.screenshot))?.screenshot;if(!l&&e.urlscan){const n=Object.values(e.urlscan).find((e=>e.screenshot))?.screenshot;n&&(l=n)}return`\n        <div class="threat-card ${o?"crypto-threat":""}" onclick="openProfile('${esc(e.email)}')">\n            <div class="tc-header">\n                <div class="tc-identity">\n                    <div class="tc-avatar">${e.google?.photo?`<img src="${esc(e.google.photo)}">`:getInitial(e.email)}</div>\n                    <div class="tc-info">\n                        ${n?`<div class="tc-name">${esc(n)}</div>`:""}\n                        <div class="tc-email">${esc(e.email)}</div>\n                        ${a?`<div class="tc-country">${getFlag(a)} ${a}</div>`:""}\n                    </div>\n                </div>\n                <div class="tc-score ${o?"crypto":e.threat_score>200?"critical":"high"}">${o?"üí∞":Math.round((e.threat_score+e.intel_score)/10)}</div>\n            </div>\n            <div class="tc-threats">${r.join("")}</div>\n            <div class="tc-evidence">${l?`<img src="${esc(l)}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=tc-no-screenshot>${ICONS.screenshot}<span>No preview</span></div>'">`:`<div class="tc-no-screenshot">${ICONS.screenshot}<span>No preview</span></div>`}</div>\n            <div class="tc-stats">\n                <span>${ICONS.domain} ${e.total_domains||0}</span>\n                ${e.leak_intel?.phones?.length?`<span>${ICONS.phone} ${e.leak_intel.phones.length}</span>`:""}\n                ${e.passwords?.length?`<span>${ICONS.key} ${e.passwords.length}</span>`:""}\n            </div>\n        </div>\n    `}function renderActorPreview(e){const n=e.leak_intel?.real_names?.[0]||e.google?.name||"",a=getActorCountry(e);return`\n        <div class="actor-preview" onclick="openProfile('${esc(e.email)}')">\n            <div class="ap-avatar">${e.google?.photo?`<img src="${esc(e.google.photo)}">`:getInitial(e.email)}</div>\n            <div class="ap-info">\n                ${n?`<div class="ap-name">${esc(n)}</div>`:""}\n                <div class="ap-email">${esc(e.email)}</div>\n                <div class="ap-meta">\n                    ${a?`<span>${getFlag(a)}</span>`:""}\n                    <span>${e.total_domains||0} domains</span>\n                    ${e.google?.person_id?`<span class="has-google">${ICONS.google} Google</span>`:""}\n                </div>\n            </div>\n            <div class="ap-tags">\n                ${getVTArray(e).length?'<span class="tag-danger">MAL</span>':""}\n                ${getBLArray(e).length?'<span class="tag-warning">PHISH</span>':""}\n            </div>\n        </div>\n    `}function renderActors(){const e=document.getElementById("actors-container");if(!e)return;const n=(page-1)*perPage,a=filtered.slice(n,n+perPage);a.length?(e.innerHTML=a.map((e=>renderActorCard(e))).join(""),renderPagination()):e.innerHTML='<div class="empty-state"><h3>No actors found</h3></div>'}function renderActorCard(e){const n=e.leak_intel?.real_names?.[0]||e.leak_info?.fullname||e.google?.name||e.contacts?.find((e=>e.name&&!e.name.includes("REDACTED")&&!e.name.includes("???")))?.name||"",a=getActorCountry(e),s=dedupePhones([...e.leak_intel?.phones||[],...e.leak_info?.phone?[{phone:e.leak_info.phone}]:[]]),t=(s[0]||e.contacts?.find((e=>e.phone&&"REDACTED FOR PRIVACY"!==e.phone)),getActorScreenshots(e)),i=getVTArray(e),o=getBLArray(e),r=getBrandArray(e),l=i.length>0,c=o.length>0,d=r.length>0,p=hasCryptoBrand(e),h=l?"critical":c?"high":d?"medium":"low",g=e.intel_score||0,u=e.threat_score||0,v=e.passwords?.length>0,m=r[0]||"";return`\n        <div class="actor-card ${l?"has-malware":""} ${c?"has-phishing":""}" onclick="openProfile('${esc(e.email)}')">\n            \x3c!-- Header with threat level and score --\x3e\n            <div class="ac-header">\n                <div class="ac-threat-level ${h}">\n                    <span class="threat-dot"></span>\n                    <span>${"critical"===h?"CRITICAL":"high"===h?"HIGH RISK":"medium"===h?"MEDIUM":"LOW"}</span>\n                </div>\n                ${u>0?`<div class="ac-score">${u}</div>`:""}\n            </div>\n\n            \x3c!-- Screenshot Gallery --\x3e\n            <div class="ac-visual">\n                ${t.length?`\n                    <div class="ac-screenshot-main">\n                        <img src="${esc(t[0].screenshot)}" loading="lazy" alt="Evidence" onerror="this.closest('.ac-screenshot-main').classList.add('error')">\n                        <div class="ac-screenshot-overlay">\n                            <div class="ac-screenshot-info">\n                                <span class="ac-screenshot-domain">${esc(t[0].domain||"Unknown domain")}</span>\n                                ${t.length>1?`<span class="ac-screenshot-count">üì∑ ${t.length} screenshots</span>`:""}\n                            </div>\n                        </div>\n                    </div>\n                `:`\n                    <div class="ac-no-screenshot">\n                        <div class="ac-no-screenshot-content">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                                <rect x="3" y="3" width="18" height="18" rx="2"/>\n                                <circle cx="8.5" cy="8.5" r="1.5"/>\n                                <path d="m21 15-5-5L5 21"/>\n                            </svg>\n                            <span>No Visual Evidence</span>\n                            <small>${e.total_domains||0} domains registered</small>\n                        </div>\n                    </div>\n                `}\n            </div>\n\n            \x3c!-- Identity Section --\x3e\n            <div class="ac-identity">\n                <div class="ac-avatar-wrapper">\n                    <div class="ac-avatar ${e.google?.photo?"has-photo":""}">\n                        ${e.google?.photo?`<img src="${esc(e.google.photo)}" onerror="this.parentElement.innerHTML='${getInitial(e.email)}'">`:getInitial(e.email)}\n                    </div>\n                    ${e.google?.person_id?'<div class="ac-verified" title="Google Account Found">‚úì</div>':""}\n                </div>\n                <div class="ac-details">\n                    ${n?`<div class="ac-name">${esc(n)}</div>`:""}\n                    <div class="ac-email">${esc(e.email)}</div>\n                    <div class="ac-meta">\n                        ${a?`<span class="ac-country">${getFlag(a)} ${a}</span>`:""}\n                        ${s.length?`<span class="ac-phone">üì± ${s.length}</span>`:""}\n                        ${hasAndroid(e)?'<span class="ac-android" title="Android Device">ü§ñ</span>':""}\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Threat Indicators --\x3e\n            ${l||c||p||m||v?`\n                <div class="ac-threats">\n                    ${l?`<div class="ac-threat-item malware"><span class="ac-threat-icon">‚ò†Ô∏è</span><span class="ac-threat-label">${i.length} Malware</span></div>`:""}\n                    ${c?`<div class="ac-threat-item phishing"><span class="ac-threat-icon">üé£</span><span class="ac-threat-label">${o.length} Phishing</span></div>`:""}\n                    ${p?'<div class="ac-threat-item crypto"><span class="ac-threat-icon">üí∞</span><span class="ac-threat-label">Crypto Scam</span></div>':""}\n                    ${m&&!p?`<div class="ac-threat-item brand"><span class="ac-threat-icon">üè∑Ô∏è</span><span class="ac-threat-label">${m}</span></div>`:""}\n                    ${v?`<div class="ac-threat-item leak"><span class="ac-threat-icon">üîë</span><span class="ac-threat-label">${e.passwords.length} Passwords</span></div>`:""}\n                </div>\n            `:""}\n\n            \x3c!-- Stats Footer --\x3e\n            <div class="ac-footer">\n                <div class="ac-stat-item">\n                    <span class="ac-stat-value">${e.total_domains||0}</span>\n                    <span class="ac-stat-label">Domains</span>\n                </div>\n                <div class="ac-stat-item ${i.length+o.length>0?"danger":""}">\n                    <span class="ac-stat-value">${i.length+o.length}</span>\n                    <span class="ac-stat-label">Threats</span>\n                </div>\n                <div class="ac-stat-item ${getLeakCount(e)>0?"warning":""}">\n                    <span class="ac-stat-value">${getLeakCount(e)}</span>\n                    <span class="ac-stat-label">Leaks</span>\n                </div>\n                <div class="ac-stat-item">\n                    <span class="ac-stat-value">${g}</span>\n                    <span class="ac-stat-label">Intel</span>\n                </div>\n            </div>\n        </div>\n    `}function renderThreats(){if(!document.getElementById("threats-container"))return;const e=[],n=new Set;(filtered.length?filtered:DATA.emails).forEach((a=>{(Array.isArray(a.virustotal)?a.virustotal:a.virustotal&&"object"==typeof a.virustotal?Object.entries(a.virustotal).map((([e,n])=>({domain:e,...n}))):[]).forEach((s=>{if(!s.malicious&&!s.suspicious)return;const t=a.domain_cards?.find((e=>e.domain===s.domain))||a.urlscan?.[s.domain],i=t?.whois?.registrar||t?.whois?.Registrar||null;i&&n.add(i),e.push({type:"malware",severity:10*(s.malicious||0),actor:a,domain:s.domain,detections:s.malicious||0,total:(s.harmless||0)+(s.malicious||0)+(s.suspicious||0),screenshot:t?.screenshot,ip:t?.ip,country:t?.country,registrar:i,created:t?.whois?.creation_date||t?.whois?.CreationDate})}));(Array.isArray(a.blacklist)?a.blacklist:a.blacklist&&"object"==typeof a.blacklist?Object.entries(a.blacklist).map((([e,n])=>({domain:e,...n}))):[]).forEach((s=>{if(!s.blacklisted&&!s.brand_impersonation?.length)return;if(e.find((e=>e.domain===s.domain)))return;const t=a.domain_cards?.find((e=>e.domain===s.domain))||a.urlscan?.[s.domain],i=t?.whois?.registrar||t?.whois?.Registrar||null;i&&n.add(i),e.push({type:"phishing",severity:s.risk_score||50,actor:a,domain:s.domain,sources:s.blacklist_sources||s.sources||[],screenshot:t?.screenshot,ip:t?.ip,country:t?.country,registrar:i,created:t?.whois?.creation_date||t?.whois?.CreationDate})}))})),window.threatRegistrars=[...n].sort(),allThreats=e,populateRegistrarFilter(),filterThreats()}function renderGraph(){const e=document.getElementById("graph-container");if(!e)return;e.innerHTML='\n        <div class="graph-layout">\n            <div class="graph-sidebar">\n                <div class="graph-search">\n                    <input type="text" id="graph-search" placeholder="Search actors...">\n                </div>\n                <div class="graph-actor-list" id="graph-actor-list"></div>\n            </div>\n            <div class="graph-main">\n                <div class="graph-canvas" id="graph-canvas"></div>\n                <div class="graph-info-panel" id="graph-info-panel">\n                    <div class="info-placeholder">Select a node to view details</div>\n                </div>\n            </div>\n        </div>\n    ',renderGraphActorList(),document.getElementById("graph-search")?.addEventListener("input",debounce((e=>{renderGraphActorList(e.target.value.toLowerCase())}),200));const n=DATA.emails||[];selectedActor?renderActorGraph(selectedActor):n.length&&(selectedActor=n[0],renderActorGraph(selectedActor))}function renderGraphActorList(e=""){const n=document.getElementById("graph-actor-list");if(!n)return;const a=DATA.emails||[];let s=[...a].sort(((e,n)=>(n.threat_score||0)-(e.threat_score||0)));e&&(s=s.filter((n=>n.email.toLowerCase().includes(e)||(n.leak_intel?.real_names?.[0]||"").toLowerCase().includes(e)))),s=s.slice(0,150);const t=a.length,i=a.filter((e=>getVTArray(e).length||getBLArray(e).length)).length;n.innerHTML=`\n        <div class="ga-stats">\n            <div class="ga-stats-item">\n                <span class="ga-stats-value">${t}</span>\n                <span class="ga-stats-label">Actors</span>\n            </div>\n            <div class="ga-stats-item danger">\n                <span class="ga-stats-value">${i}</span>\n                <span class="ga-stats-label">Threats</span>\n            </div>\n        </div>\n        ${s.map(((e,n)=>{const a=e.leak_intel?.real_names?.[0]||e.leak_info?.fullname||e.google?.name||"",s=getVTArray(e).length,t=getBLArray(e).length,i=s||t,o=s?"critical":t?"high":"low",r=getActorScreenshots(e),l=getActorCountry(e);return`\n                <div class="graph-actor ${selectedActor?.email===e.email?"active":""} ${i?"has-threat":""}"\n                     onclick="selectGraphActor('${esc(e.email)}')"\n                     style="animation-delay: ${.02*n}s">\n                    <div class="ga-avatar-wrap">\n                        <div class="ga-avatar ${e.google?.photo?"has-photo":""}">\n                            ${e.google?.photo?`<img src="${esc(e.google.photo)}" onerror="this.parentElement.innerHTML='${getInitial(e.email)}'">`:getInitial(e.email)}\n                        </div>\n                        ${i?`<span class="ga-threat-badge ${o}">${s+t}</span>`:""}\n                    </div>\n                    <div class="ga-content">\n                        <div class="ga-header">\n                            ${a?`<span class="ga-name">${esc(a.length>18?a.slice(0,16)+"..":a)}</span>`:""}\n                            ${l?`<span class="ga-flag">${getFlag(l)}</span>`:""}\n                        </div>\n                        <div class="ga-email">${esc(e.email.length>24?e.email.slice(0,22)+"..":e.email)}</div>\n                        <div class="ga-meta">\n                            <span class="ga-domains">${e.total_domains||0} domains</span>\n                            ${r.length?`<span class="ga-screens">üì∑ ${r.length}</span>`:""}\n                        </div>\n                    </div>\n                    ${i?`\n                        <div class="ga-indicators">\n                            ${s?`<span class="ga-ind malware" title="${s} Malware">‚ò†Ô∏è</span>`:""}\n                            ${t?`<span class="ga-ind phishing" title="${t} Phishing">üé£</span>`:""}\n                        </div>\n                    `:""}\n                </div>\n            `})).join("")}\n    `}function selectGraphActor(e){const n=DATA.emails.find((n=>n.email===e));n&&(selectedActor=n,document.querySelectorAll(".graph-actor").forEach((n=>{n.classList.toggle("active",n.querySelector(".ga-email")?.textContent===e)})),renderActorGraph(n))}function renderActorGraph(e){const n=document.getElementById("graph-canvas");if(!n||!e)return;n.innerHTML="";const a=n.getBoundingClientRect(),s=a.width>100?a.width:800,t=a.height>100?a.height:600,i=[],o=[],r=new Set,l={email:"#0ea5e9",google:"#f43f5e",services:"#22c55e",name:"#a855f7",phone:"#14b8a6",passwords_group:"#ef4444",leaked_site:"#fb923c",leaks_group:"#fbbf24",leak_db:"#facc15",threats_group:"#ef4444",malware:"#dc2626",phishing:"#f59e0b",ips_group:"#8b5cf6",domains_group:"#06b6d4",screenshots_group:"#3b82f6",connected_email:"#64748b"},c="email_main";if(i.push({id:c,type:"email",label:e.email,data:e,size:50,color:l.email,fx:s/2,fy:t/2}),r.add(c),e.google?.person_id){const n="google";if(i.push({id:n,type:"google",label:e.google.name||"Google Account",data:e.google,size:36,color:l.google}),o.push({source:c,target:n,type:"has_google"}),r.add(n),e.google.services?.length){const a="google_services";i.push({id:a,type:"services",label:e.google.services.slice(0,3).join(", "),data:e.google.services,size:24,color:l.services}),o.push({source:n,target:a,type:"uses"})}}if(e.leak_intel?.real_names?.length){const n="real_name";i.push({id:n,type:"name",label:e.leak_intel.real_names[0],data:e.leak_intel.real_names,size:34,color:l.name}),o.push({source:c,target:n,type:"identity"}),r.add(n)}if(dedupePhones(e.leak_intel?.phones||[]).slice(0,3).forEach(((e,n)=>{const a=`phone_${n}`,s=getCountryFromPhone(e.phone);i.push({id:a,type:"phone",label:e.phone,data:e,country:s,size:28,color:l.phone}),o.push({source:c,target:a,type:"has_phone",label:e.source}),r.add(a)})),e.registrants?.length){const n=[...new Set(e.registrants.map((e=>e.name)).filter((e=>e&&!e.includes("REDACTED")&&!e.includes("???")&&e.length>2)))];if(n.length){const a="registrant",s=1===n.length?n[0]:`${n.length} Registrants`;i.push({id:a,type:"registrar",label:s.slice(0,22),data:{names:n,records:e.registrants},size:30,color:l.registrar||"#a855f7"}),o.push({source:c,target:a,type:"registered_as"}),r.add(a)}}const d={};if((e.passwords||[]).forEach((e=>{const n=(("object"==typeof e?e.url:"")||"unknown").replace(/^https?:\/\//,"").split("/")[0].replace(/^www\./,"");d[n]||(d[n]=[]),d[n].push(e)})),Object.keys(d).length){const n="passwords";i.push({id:n,type:"passwords_group",label:`${e.passwords.length} Passwords`,data:e.passwords,size:32,color:l.passwords_group}),o.push({source:c,target:n,type:"leaked_creds"}),Object.entries(d).slice(0,6).forEach((([e,a],s)=>{if("unknown"===e||!e)return;const t=`pwd_site_${s}`;i.push({id:t,type:"leaked_site",label:e.slice(0,18),data:{domain:e,passwords:a},size:22,color:l.leaked_site}),o.push({source:n,target:t,type:"on_site"})}))}if(e.leak_extended?.databases?.length){const n="leaks";i.push({id:n,type:"leaks_group",label:`${e.leak_extended.databases.length} Leaks`,data:e.leak_extended.databases,size:30,color:l.leaks_group}),o.push({source:c,target:n,type:"found_in"}),e.leak_extended.databases.slice(0,5).forEach(((e,a)=>{const s=`leak_db_${a}`;i.push({id:s,type:"leak_db",label:(e.database||e.source||"Unknown").slice(0,15),data:e,size:20,color:l.leak_db}),o.push({source:n,target:s,type:"database"})}))}const p=Array.isArray(e.virustotal)?e.virustotal:e.virustotal&&"object"==typeof e.virustotal?Object.entries(e.virustotal).filter((([e,n])=>n.malicious||n.suspicious)).map((([e,n])=>({domain:e,...n}))):[],h=Array.isArray(e.blacklist)?e.blacklist:e.blacklist&&"object"==typeof e.blacklist?Object.entries(e.blacklist).filter((([e,n])=>n.blacklisted||n.brand_impersonation?.length)).map((([e,n])=>({domain:e,...n}))):[],g=[...p.map((e=>({...e,type:"malware"}))),...h.map((e=>({...e,type:"phishing"})))],u=(e.domain_cards||[]).filter((e=>e.screenshot)),v=new Set(g.map((e=>e.domain))),m=e.domains?.length||e.total_domains||0;if(m>0){const n="domains";if(i.push({id:n,type:"domains_group",label:`${m} Domains`,data:e.domains,size:32,color:"#64748b"}),o.push({source:c,target:n,type:"owns"}),g.length){const a="threats";i.push({id:a,type:"threats_group",label:`${g.length} Threats`,data:g,size:34,color:l.threats_group}),o.push({source:n,target:a,type:"includes"}),g.slice(0,10).forEach(((n,s)=>{const t=`threat_${s}`,r=e.domain_cards?.find((e=>e.domain===n.domain));i.push({id:t,type:n.type,label:n.domain.length>18?n.domain.slice(0,16)+"..":n.domain,domain:n.domain,data:{...n,card:r},size:26,color:"malware"===n.type?l.malware:l.phishing,hasScreenshot:!!r?.screenshot,screenshot:r?.screenshot}),o.push({source:a,target:t,type:n.type,label:"malware"===n.type?`${n.malicious} detections`:n.sources?.slice(0,2).join(", ")||""})}))}const a=u.filter((e=>!v.has(e.domain))).slice(0,6);if(a.length){const e="screenshots";i.push({id:e,type:"screenshots_group",label:`${u.length} Scanned`,data:u,size:28,color:"#0ea5e9"}),o.push({source:n,target:e,type:"scanned"}),a.forEach(((n,a)=>{const s=`scanned_${a}`;i.push({id:s,type:"domain",label:n.domain.length>18?n.domain.slice(0,16)+"..":n.domain,domain:n.domain,data:n,size:22,color:"#38bdf8",hasScreenshot:!0,screenshot:n.screenshot}),o.push({source:e,target:s,type:"has_scan"})}))}}const f=dedupeIPs(e.leak_intel?.ips||[]);if(f.length){const e="ips";i.push({id:e,type:"ips_group",label:`${f.length} IPs`,data:f,size:28,color:l.ips_group}),o.push({source:c,target:e,type:"used_ip"})}const $=e.connected_emails||[];if($.length){const e="connections";i.push({id:e,type:"connections_group",label:`${$.length} Connected`,data:$,size:30,color:"#ec4899"}),o.push({source:c,target:e,type:"shared_password"}),$.slice(0,5).forEach(((n,a)=>{const s=DATA.emails.find((e=>e.email===n)),t=`conn_${a}`;i.push({id:t,type:"connected_email",label:n.length>20?n.slice(0,18)+"..":n,email:n,data:s||{email:n},size:22,color:s?.blacklist?.length?"#f59e0b":"#f472b6",hasPhoto:!!s?.google?.photo,photo:s?.google?.photo}),o.push({source:e,target:t,type:"shared_cred"})}))}const y=d3.select(n).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${s} ${t}`),w=y.append("defs");Object.entries({email:["#38bdf8","#0284c7"],google:["#fb7185","#e11d48"],services:["#4ade80","#16a34a"],name:["#c084fc","#9333ea"],phone:["#2dd4bf","#0d9488"],passwords_group:["#f87171","#dc2626"],leaked_site:["#fdba74","#ea580c"],leaks_group:["#fcd34d","#d97706"],leak_db:["#fde047","#ca8a04"],threats_group:["#f87171","#b91c1c"],malware:["#fca5a5","#991b1b"],phishing:["#fcd34d","#b45309"],ips_group:["#c4b5fd","#7c3aed"],domains_group:["#67e8f9","#0891b2"],screenshots_group:["#93c5fd","#2563eb"],domain:["#a5f3fc","#06b6d4"],connected_email:["#cbd5e1","#475569"],connections_group:["#a5b4fc","#4f46e5"],registrar:["#d8b4fe","#a855f7"]}).forEach((([e,[n,a]])=>{const s=w.append("radialGradient").attr("id",`grad-${e}`).attr("cx","30%").attr("cy","30%").attr("r","70%");s.append("stop").attr("offset","0%").attr("stop-color",n),s.append("stop").attr("offset","100%").attr("stop-color",a)}));const b=w.append("filter").attr("id","glow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");b.append("feGaussianBlur").attr("stdDeviation","4").attr("result","blur"),b.append("feMerge").html('<feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/>');const k=w.append("filter").attr("id","danger-glow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");k.append("feGaussianBlur").attr("stdDeviation","6").attr("result","blur"),k.append("feFlood").attr("flood-color","#ef4444").attr("flood-opacity","0.5"),k.append("feComposite").attr("in2","blur").attr("operator","in"),k.append("feMerge").html('<feMergeNode/><feMergeNode in="SourceGraphic"/>');const _=y.append("g");y.call(d3.zoom().scaleExtent([.2,4]).on("zoom",(e=>_.attr("transform",e.transform))));const A=d3.forceSimulation(i).force("link",d3.forceLink(o).id((e=>e.id)).distance(100)).force("charge",d3.forceManyBody().strength(-200)).force("center",d3.forceCenter(s/2,t/2)).force("collision",d3.forceCollide().radius((e=>e.size+10))),x=_.append("g").selectAll("line").data(o).join("line").attr("stroke","#374151").attr("stroke-width",1.5).attr("stroke-opacity",.5);let C=null;function I(e){return{email:"#38bdf8",registrar:"#c084fc",google:"#fb7185",services:"#4ade80",name:"#c084fc",phone:"#2dd4bf",malware:"#f87171",phishing:"#fbbf24",threats_group:"#f87171",passwords_group:"#f87171",leaked_site:"#fb923c",leaks_group:"#fcd34d",leak_db:"#fde047",ips_group:"#a78bfa",domains_group:"#22d3ee",screenshots_group:"#60a5fa",domain:e.hasScreenshot?"#38bdf8":"rgba(255,255,255,0.3)",connected_email:"#94a3b8",connections_group:"#818cf8"}[e.type]||"rgba(255,255,255,0.2)"}const E=_.append("g").selectAll("g").data(i).join("g").attr("class","graph-node").style("cursor","pointer").call(d3.drag().on("start",((e,n)=>{e.active||A.alphaTarget(.3).restart(),n.fx=n.x,n.fy=n.y})).on("drag",((e,n)=>{n.fx=e.x,n.fy=e.y})).on("end",((e,n)=>{e.active||A.alphaTarget(0),"email"!==n.type&&(n.fx=null,n.fy=null)}))).on("click",((n,a)=>{if(n.stopPropagation(),C){const e=d3.select(C).datum();d3.select(C).select(".main-circle").attr("stroke-width","malware"===e.type||"phishing"===e.type?3:2).attr("stroke",I(e))}C=n.currentTarget,d3.select(C).select(".main-circle").attr("stroke","#fff").attr("stroke-width",4),showNodeInfo(a,e);const s=document.getElementById("graph-info-panel");s&&s.classList.add("active")})).on("mouseenter",(function(e,n){d3.select(this).select(".main-circle").transition().duration(150).attr("r",n.size+4)})).on("mouseleave",(function(e,n){d3.select(this).select(".main-circle").transition().duration(150).attr("r",n.size)})),S={email:"üìß",google:"üîç",services:"üì±",name:"üë§",phone:"üìû",registrar:"üìã",passwords_group:"üîë",leaked_site:"üåê",leaks_group:"üíß",leak_db:"üóÑÔ∏è",threats_group:"‚ö†Ô∏è",malware:"‚ò†Ô∏è",phishing:"üé£",ips_group:"üñ•Ô∏è",domains_group:"üåê",screenshots_group:"üì∑",domain:"üîó",connections_group:"üîó",connected_email:"üìß"};E.each((function(e){const n=d3.select(this);if(["malware","phishing","threats_group","email","passwords_group","leaks_group"].includes(e.type)&&n.append("circle").attr("r",e.size+10).attr("fill","none").attr("stroke",e.color).attr("stroke-width",3).attr("stroke-opacity",.25).style("filter","blur(6px)"),"malware"!==e.type&&"phishing"!==e.type||n.append("circle").attr("r",e.size+16).attr("fill","none").attr("stroke",e.color).attr("stroke-width",2).attr("stroke-opacity",.15).style("filter","blur(10px)"),"malware"!==e.type&&"phishing"!==e.type&&"domain"!==e.type||!e.domain){const a=["malware","phishing","threats_group","passwords_group"].includes(e.type);n.append("circle").attr("class","main-circle").attr("r",e.size).attr("fill",`url(#grad-${e.type})`).attr("stroke",I(e)).attr("stroke-width",a?3:2).style("filter",a?"url(#danger-glow)":"url(#glow)"),n.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size",.55*e.size).style("pointer-events","none").text(S[e.type]||"üìÑ")}else{n.append("circle").attr("class","main-circle").attr("r",e.size).attr("fill",`url(#grad-${e.type})`).attr("stroke",I(e)).attr("stroke-width","domain"!==e.type?3:2).style("filter","malware"===e.type||"phishing"===e.type?"url(#danger-glow)":"url(#glow)");const a=`clip-${e.id}`;n.append("clipPath").attr("id",a).append("circle").attr("r",.65*e.size),n.append("image").attr("href",getFavicon(e.domain)).attr("x",.55*-e.size).attr("y",.55*-e.size).attr("width",1.1*e.size).attr("height",1.1*e.size).attr("clip-path",`url(#${a})`).attr("preserveAspectRatio","xMidYMid slice").style("pointer-events","none").on("error",(function(){d3.select(this).remove(),n.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size",.55*e.size).style("pointer-events","none").text(S[e.type]||"üåê")})),e.hasScreenshot&&(n.append("circle").attr("cx",.6*e.size).attr("cy",.6*-e.size).attr("r",8).attr("fill","#22c55e").attr("stroke","#fff").attr("stroke-width",2),n.append("text").attr("x",.6*e.size).attr("y",.6*-e.size).attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size",8).attr("fill","#fff").text("üì∑")),"malware"!==e.type&&"phishing"!==e.type||(n.append("circle").attr("cx",.6*-e.size).attr("cy",.6*-e.size).attr("r",10).attr("fill","malware"===e.type?"#dc2626":"#f59e0b").attr("stroke","#fff").attr("stroke-width",2),n.append("text").attr("x",.6*-e.size).attr("y",.6*-e.size).attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size",10).text("malware"===e.type?"‚ò†Ô∏è":"üé£"))}"phone"===e.type&&e.country&&n.append("text").attr("x",.7*e.size).attr("y",.7*-e.size).attr("font-size",14).text(getCountryEmoji(e.country))})),E.append("text").attr("dy",(e=>e.size+14)).attr("text-anchor","middle").attr("fill","#e5e7eb").attr("font-size","11px").attr("font-weight","500").style("text-shadow","0 1px 3px rgba(0,0,0,0.8)").text((e=>e.label.length>22?e.label.slice(0,20)+"..":e.label)),A.on("tick",(()=>{x.attr("x1",(e=>e.source.x)).attr("y1",(e=>e.source.y)).attr("x2",(e=>e.target.x)).attr("y2",(e=>e.target.y)),E.attr("transform",(e=>`translate(${e.x},${e.y})`))})),showNodeInfo(i[0],e)}function showNodeInfo(e,n){const a=document.getElementById("graph-info-panel");if(!a)return;let s="";const t=e.type;if("email"===t){const n=e.data,a=n.leak_intel?.real_names?.[0]||n.google?.name||"",t=getActorCountry(n),i=hasCryptoBrand(n),o=getBrandArray(n),r=getThreatCount(n),l=n.leak_intel?.phones||n.leak_info?.phone?[n.leak_info?.phone]:[];let c=n.domain_cards?.filter((e=>e.screenshot))||[];!c.length&&n.urlscan&&(c=Object.entries(n.urlscan).filter((([e,n])=>n.screenshot)).map((([e,n])=>({domain:e,screenshot:n.screenshot,...n}))).slice(0,6)),s=`\n            <div class="panel-header ${i?"crypto":""}">\n                <div class="panel-avatar">${n.google?.photo?`<img src="${esc(n.google.photo)}">`:getInitial(n.email)}</div>\n                <div class="panel-identity">\n                    ${a?`<div class="panel-name">${esc(a)}</div>`:""}\n                    <div class="panel-email">${esc(n.email)}</div>\n                    ${t?`<div class="panel-location">${getFlag(t)} ${t.toUpperCase()}</div>`:""}\n                </div>\n            </div>\n\n            ${o.length?`\n                <div class="panel-brands">\n                    ${i?'<span class="brand-tag crypto">üí∞ Crypto</span>':""}\n                    ${o.slice(0,3).map((e=>`<span class="brand-tag">${esc(e)}</span>`)).join("")}\n                </div>\n            `:""}\n\n            <div class="panel-stats">\n                ${n.total_domains?`<div class="ps-item"><span>${n.total_domains}</span>Domains</div>`:""}\n                ${r>0?`<div class="ps-item danger"><span>${r}</span>Threats</div>`:""}\n                ${n.passwords?.length?`<div class="ps-item"><span>${n.passwords.length}</span>Creds</div>`:""}\n                ${l.length?`<div class="ps-item"><span>${l.length}</span>Phones</div>`:""}\n            </div>\n\n            ${c.length?`\n                <div class="panel-section-title">üì∑ Phishing Sites</div>\n                <div class="panel-screenshots">\n                    ${c.slice(0,4).map((e=>`\n                        <div class="panel-thumb" onclick="openModal('${esc(e.screenshot)}', '${esc(e.domain)}')">\n                            <img src="${esc(e.screenshot)}" loading="lazy">\n                            <span>${esc(e.domain.slice(0,20))}</span>\n                        </div>\n                    `)).join("")}\n                </div>\n            `:""}\n\n            ${n.leak_info?.nickname||n.leak_info?.address?`\n                <div class="panel-section-title">üîç Leaked Info</div>\n                <div class="panel-details">\n                    ${n.leak_info?.nickname?`<div class="pd-row"><span>Nickname</span>${esc(n.leak_info.nickname)}</div>`:""}\n                    ${n.leak_info?.address?`<div class="pd-row"><span>Address</span>${esc(n.leak_info.address.slice(0,50))}</div>`:""}\n                    ${l[0]?`<div class="pd-row"><span>Phone</span>${esc(l[0])}</div>`:""}\n                </div>\n            `:""}\n\n            <button class="btn-profile" onclick="openProfile('${esc(n.email)}')">View Full Profile</button>\n        `}else if("google"===t){const n=e.data;s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-google">${n.photo?`<img src="${esc(n.photo)}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">`:"üîç"}</div>\n                    <div class="node-info-title">\n                        <h3>${esc(n.name||"Google Account")}</h3>\n                        <span class="node-type-badge info">GOOGLE</span>\n                    </div>\n                </div>\n\n                <div class="node-info-section">\n                    <h4>Account Details</h4>\n                    <div class="node-info-row">\n                        <span class="label">Person ID</span>\n                        <span class="value monospace" style="font-size:11px">${esc(n.person_id)}</span>\n                    </div>\n                    ${n.name?`\n                    <div class="node-info-row">\n                        <span class="label">Name</span>\n                        <span class="value">${esc(n.name)}</span>\n                    </div>\n                    `:""}\n                    ${n.last_updated?`\n                    <div class="node-info-row">\n                        <span class="label">Last Updated</span>\n                        <span class="value">${esc(n.last_updated)}</span>\n                    </div>\n                    `:""}\n                    ${n.uses_android?'\n                    <div class="node-info-row">\n                        <span class="label">Platform</span>\n                        <span class="value">ü§ñ Android</span>\n                    </div>\n                    ':""}\n                </div>\n\n                ${n.services?.length?`\n                <div class="node-info-section">\n                    <h4>Google Services (${n.services.length})</h4>\n                    <div class="node-info-tags">\n                        ${n.services.map((e=>`<span class="node-info-tag">${esc(e)}</span>`)).join("")}\n                    </div>\n                </div>\n                `:""}\n            </div>\n        `}else if("services"===t){s=`\n            <div class="panel-header">\n                <div class="panel-icon services">üì±</div>\n                <div class="panel-title">Google Services</div>\n            </div>\n            <div class="panel-list">\n                ${e.data.map((e=>`<div class="pl-item service">${esc(e)}</div>`)).join("")}\n            </div>\n        `}else if("name"===t){s=`\n            <div class="panel-header">\n                <div class="panel-icon name">üë§</div>\n                <div class="panel-title">Real Name</div>\n            </div>\n            <div class="panel-list">\n                ${(Array.isArray(e.data)?e.data:[e.data]).map((e=>`<div class="pl-item name">${esc(e)}</div>`)).join("")}\n            </div>\n        `}else if("phone"===t){const n=e.data,a=e.country||getCountryFromPhone(n.phone);s=`\n            <div class="panel-header">\n                <div class="panel-icon phone">üìû</div>\n                <div class="panel-title">Phone Number</div>\n            </div>\n            <div class="panel-details">\n                <div class="pd-row"><span>Number</span>${a?getFlag(a):""} <strong>${esc(n.phone)}</strong></div>\n                ${n.source?`<div class="pd-row"><span>Source</span>${esc(n.source)}</div>`:""}\n                ${a?`<div class="pd-row"><span>Country</span>${getFlag(a)} ${a.toUpperCase()}</div>`:""}\n            </div>\n        `}else if("registrar"===t){const n=e.data,a=n.names||[],t=n.records||[],i=[...new Set(t.map((e=>e.domain)))],o=[...new Set(t.map((e=>e.country)).filter((e=>e&&!e.includes("REDACTED"))))];s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-service">üìã</div>\n                    <div class="node-info-title">\n                        <h3>WHOIS Registrant</h3>\n                        <span class="node-type-badge info">IDENTITY</span>\n                    </div>\n                </div>\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-user"></i> Registrant Names</h4>\n                    ${a.slice(0,5).map((e=>`\n                        <div class="node-info-row">\n                            <span class="label">üë§</span>\n                            <span class="value">${esc(e)}</span>\n                        </div>\n                    `)).join("")}\n                    ${a.length>5?`<div style="padding:4px 0;color:var(--text-muted);font-size:11px">+${a.length-5} more names</div>`:""}\n                </div>\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-globe"></i> Registered Domains (${i.length})</h4>\n                    <div class="node-info-tags">\n                        ${i.slice(0,8).map((e=>`<span class="node-info-tag">${esc(e)}</span>`)).join("")}\n                    </div>\n                    ${i.length>8?`<div style="padding:4px 0;color:var(--text-muted);font-size:11px">+${i.length-8} more</div>`:""}\n                </div>\n\n                ${o.length?`\n                <div class="node-info-section">\n                    <h4><i class="fas fa-map-marker-alt"></i> Countries</h4>\n                    <div class="node-info-tags">\n                        ${o.slice(0,5).map((e=>`<span class="node-info-tag">${getFlag(e)} ${esc(e)}</span>`)).join("")}\n                    </div>\n                </div>\n                `:""}\n            </div>\n        `}else if("passwords_group"===t){const n=e.data,a=[...new Set(n.map((e=>"string"==typeof e?e:e.password||"")))];s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-password">üîë</div>\n                    <div class="node-info-title">\n                        <h3>Leaked Credentials</h3>\n                        <span class="node-type-badge threat">EXPOSED</span>\n                    </div>\n                </div>\n\n                <div class="threat-level high">\n                    <div class="threat-level-icon">üîê</div>\n                    <div class="threat-level-text">\n                        <div class="level">Credentials Exposed</div>\n                        <div class="desc">${n.length} password${n.length>1?"s":""} found in ${a.length} unique</div>\n                    </div>\n                </div>\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-key"></i> Leaked Passwords</h4>\n                    ${n.slice(0,10).map((e=>{const n="string"==typeof e?e:e.password||"",a="object"==typeof e?(e.url||"").replace(/^https?:\/\//,"").split("/")[0]:"";return`\n                        <div class="node-info-row">\n                            <span class="label">${a?esc(a.slice(0,20)):"Password"}</span>\n                            <span class="value monospace danger">${esc(n)}</span>\n                        </div>`})).join("")}\n                    ${n.length>10?`<div style="padding:8px 0;color:var(--text-muted);font-size:11px">+${n.length-10} more credentials</div>`:""}\n                </div>\n            </div>\n        `}else if("leaked_site"===t){const n=e.data;s=`\n            <div class="panel-header">\n                <div class="panel-icon leaked">üåê</div>\n                <div class="panel-title">Leaked From</div>\n            </div>\n            <div class="panel-details">\n                <div class="pd-row"><span>Site</span><img src="${getFavicon(n.domain)}" style="width:16px;height:16px;vertical-align:middle;margin-right:6px" onerror="this.style.display='none'">${esc(n.domain)}</div>\n                <div class="pd-row"><span>Passwords</span><strong>${n.passwords?.length||0}</strong></div>\n            </div>\n            ${n.passwords?.length?`\n                <div class="panel-list">\n                    ${n.passwords.slice(0,5).map((e=>`<div class="pl-item cred"><code>${esc("string"==typeof e?e:e.password||"")}</code></div>`)).join("")}\n                </div>\n            `:""}\n        `}else if("leaks_group"===t){const n=e.data,a=[...new Set(n.map((e=>e.database||e.source||"Unknown")))];s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-leak">üíß</div>\n                    <div class="node-info-title">\n                        <h3>Data Breaches</h3>\n                        <span class="node-type-badge warning">${n.length} LEAKS</span>\n                    </div>\n                </div>\n\n                <div class="threat-level medium">\n                    <div class="threat-level-icon">üìä</div>\n                    <div class="threat-level-text">\n                        <div class="level">Data Exposed</div>\n                        <div class="desc">Found in ${a.length} different database${a.length>1?"s":""}</div>\n                    </div>\n                </div>\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-database"></i> Breach Databases</h4>\n                    <div class="node-info-tags">\n                        ${a.slice(0,15).map((e=>`<span class="node-info-tag warning">${esc(e)}</span>`)).join("")}\n                    </div>\n                    ${a.length>15?`<div style="padding:8px 0;color:var(--text-muted);font-size:11px">+${a.length-15} more databases</div>`:""}\n                </div>\n            </div>\n        `}else if("leak_db"===t){const n=e.data,a=n.data?.[0]||n;s=`\n            <div class="panel-header">\n                <div class="panel-icon db">üóÑÔ∏è</div>\n                <div class="panel-title">${esc(n.database||n.source||"Database")}</div>\n            </div>\n            <div class="panel-details">\n                ${a.username?`<div class="pd-row"><span>Username</span>${esc(a.username)}</div>`:""}\n                ${a.password?`<div class="pd-row"><span>Password</span><code>${esc(a.password)}</code></div>`:""}\n                ${a.phone?`<div class="pd-row"><span>Phone</span>${esc(a.phone)}</div>`:""}\n                ${a.name||a.FullName?`<div class="pd-row"><span>Name</span>${esc(a.name||a.FullName)}</div>`:""}\n                ${a.ip?`<div class="pd-row"><span>IP</span>${esc(a.ip)}</div>`:""}\n            </div>\n        `}else if("threats_group"===t){const n=e.data,a=n.filter((e=>"malware"===e.type)),t=n.filter((e=>"phishing"===e.type)),i=a.length>0?"critical":t.length>3?"high":"medium";s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-malware">‚ö†Ô∏è</div>\n                    <div class="node-info-title">\n                        <h3>Threat Intelligence</h3>\n                        <span class="node-type-badge threat">${n.length} THREATS</span>\n                    </div>\n                </div>\n\n                <div class="threat-level ${i}">\n                    <div class="threat-level-icon">üõ°Ô∏è</div>\n                    <div class="threat-level-text">\n                        <div class="level">${i} Risk</div>\n                        <div class="desc">${a.length} malware, ${t.length} phishing domains</div>\n                    </div>\n                </div>\n\n                ${a.length?`\n                <div class="node-info-section">\n                    <h4><i class="fas fa-skull-crossbones"></i> Malware (${a.length})</h4>\n                    ${a.slice(0,5).map((e=>`\n                        <div class="node-info-row">\n                            <span class="label">‚ò†Ô∏è</span>\n                            <span class="value monospace danger">${esc(e.domain)}</span>\n                        </div>\n                    `)).join("")}\n                    ${a.length>5?`<div style="padding:4px 0;color:var(--text-muted);font-size:11px">+${a.length-5} more</div>`:""}\n                </div>\n                `:""}\n\n                ${t.length?`\n                <div class="node-info-section">\n                    <h4><i class="fas fa-fish"></i> Phishing (${t.length})</h4>\n                    ${t.slice(0,5).map((e=>`\n                        <div class="node-info-row">\n                            <span class="label">üé£</span>\n                            <span class="value monospace warning">${esc(e.domain)}</span>\n                        </div>\n                    `)).join("")}\n                    ${t.length>5?`<div style="padding:4px 0;color:var(--text-muted);font-size:11px">+${t.length-5} more</div>`:""}\n                </div>\n                `:""}\n            </div>\n        `}else if("malware"===t){const n=e.data,a=n.card,t=(n.harmless||0)+(n.malicious||0)+(n.suspicious||0),i=t>0?Math.round(n.malicious/t*100):0,o=i>50?"critical":i>25?"high":"medium";s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-malware">‚ò†Ô∏è</div>\n                    <div class="node-info-title">\n                        <h3>${esc(n.domain)}</h3>\n                        <span class="node-type-badge threat">Malware</span>\n                    </div>\n                </div>\n\n                <div class="threat-level ${o}">\n                    <div class="threat-level-icon">‚ö†Ô∏è</div>\n                    <div class="threat-level-text">\n                        <div class="level">${o} Risk</div>\n                        <div class="desc">${n.malicious||0} of ${t} engines detected threats</div>\n                    </div>\n                </div>\n\n                ${a?.screenshot?`\n                    <div class="node-screenshot-preview">\n                        <img src="${esc(a.screenshot)}" onclick="openModal('${esc(a.screenshot)}', '${esc(n.domain)}')" style="cursor:pointer">\n                    </div>\n                `:""}\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-info-circle"></i> Domain Details</h4>\n                    <div class="node-info-row">\n                        <span class="label">Domain</span>\n                        <span class="value monospace">${esc(n.domain)}</span>\n                    </div>\n                    <div class="node-info-row">\n                        <span class="label">Detections</span>\n                        <span class="value danger">${n.malicious||0} / ${t}</span>\n                    </div>\n                    ${n.suspicious?`\n                    <div class="node-info-row">\n                        <span class="label">Suspicious</span>\n                        <span class="value warning">${n.suspicious}</span>\n                    </div>\n                    `:""}\n                    ${a?.ip?`\n                    <div class="node-info-row">\n                        <span class="label">IP Address</span>\n                        <span class="value monospace">${esc(a.ip)}</span>\n                    </div>\n                    `:""}\n                    ${a?.country?`\n                    <div class="node-info-row">\n                        <span class="label">Country</span>\n                        <span class="value">${getFlag(a.country)} ${esc(a.country.toUpperCase())}</span>\n                    </div>\n                    `:""}\n                    ${a?.server?`\n                    <div class="node-info-row">\n                        <span class="label">Server</span>\n                        <span class="value">${esc(a.server)}</span>\n                    </div>\n                    `:""}\n                </div>\n\n                <div class="node-info-actions">\n                    <a href="https://www.virustotal.com/gui/domain/${encodeURIComponent(n.domain)}" target="_blank" class="btn btn-sm">${ICONS.virustotal} VirusTotal</a>\n                    <a href="https://urlscan.io/search/#${encodeURIComponent(n.domain)}" target="_blank" class="btn btn-sm btn-secondary">URLScan</a>\n                </div>\n            </div>\n        `}else if("phishing"===t){const n=e.data,a=n.card,t=n.sources?.length||1,i=t>3?"critical":t>1?"high":"medium";s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-phishing">üé£</div>\n                    <div class="node-info-title">\n                        <h3>${esc(n.domain)}</h3>\n                        <span class="node-type-badge threat">Phishing</span>\n                    </div>\n                </div>\n\n                <div class="threat-level ${i}">\n                    <div class="threat-level-icon">üé£</div>\n                    <div class="threat-level-text">\n                        <div class="level">${i} Risk</div>\n                        <div class="desc">Listed in ${t} blocklist${t>1?"s":""}</div>\n                    </div>\n                </div>\n\n                ${a?.screenshot?`\n                    <div class="node-screenshot-preview">\n                        <img src="${esc(a.screenshot)}" onclick="openModal('${esc(a.screenshot)}', '${esc(n.domain)}')" style="cursor:pointer">\n                    </div>\n                `:""}\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-shield-alt"></i> Threat Intelligence</h4>\n                    <div class="node-info-row">\n                        <span class="label">Domain</span>\n                        <span class="value monospace">${esc(n.domain)}</span>\n                    </div>\n                    ${n.sources?.length?`\n                    <div class="node-info-row">\n                        <span class="label">Blocklists</span>\n                        <span class="value danger">${n.sources.length} sources</span>\n                    </div>\n                    `:""}\n                    ${a?.ip?`\n                    <div class="node-info-row">\n                        <span class="label">IP Address</span>\n                        <span class="value monospace">${esc(a.ip)}</span>\n                    </div>\n                    `:""}\n                    ${a?.country?`\n                    <div class="node-info-row">\n                        <span class="label">Country</span>\n                        <span class="value">${getFlag(a.country)} ${esc(a.country.toUpperCase())}</span>\n                    </div>\n                    `:""}\n                    ${a?.server?`\n                    <div class="node-info-row">\n                        <span class="label">Server</span>\n                        <span class="value">${esc(a.server)}</span>\n                    </div>\n                    `:""}\n                    ${a?.title?`\n                    <div class="node-info-row">\n                        <span class="label">Title</span>\n                        <span class="value">${esc(a.title.slice(0,40))}</span>\n                    </div>\n                    `:""}\n                </div>\n\n                ${n.sources?.length?`\n                <div class="node-info-section">\n                    <h4><i class="fas fa-list"></i> Blocklist Sources</h4>\n                    <div class="node-info-tags">\n                        ${n.sources.map((e=>`<span class="node-info-tag danger">${esc(e)}</span>`)).join("")}\n                    </div>\n                </div>\n                `:""}\n\n                <div class="node-info-actions">\n                    <a href="https://urlscan.io/search/#${encodeURIComponent(n.domain)}" target="_blank" class="btn btn-sm">URLScan</a>\n                    <a href="https://web.archive.org/web/*/${encodeURIComponent(n.domain)}" target="_blank" class="btn btn-sm btn-secondary">Archive</a>\n                </div>\n            </div>\n        `}else if("ips_group"===t){const n=e.data;s=`\n            <div class="panel-header">\n                <div class="panel-icon ip">üñ•Ô∏è</div>\n                <div class="panel-title">IP Addresses (${n.length})</div>\n            </div>\n            <div class="panel-list">\n                ${n.slice(0,10).map((e=>{const n=e.ip||e,a=getIPInfo(n);return`<div class="pl-item ip">${a.country?getFlag(a.country):""} <code>${esc(n)}</code> ${e.source?`<small>${esc(e.source)}</small>`:""}</div>`})).join("")}\n                ${n.length>10?`<div class="pl-more">+${n.length-10} more</div>`:""}\n            </div>\n        `}else if("domains_group"===t){const a=e.data||[];s=`\n            <div class="panel-header">\n                <div class="panel-icon domain">üåê</div>\n                <div class="panel-title">Domains (${a.length||n.total_domains||0})</div>\n            </div>\n            <div class="panel-list">\n                ${(a.slice?a.slice(0,12):[]).map((e=>`\n                    <div class="pl-item domain">\n                        <img src="${getFavicon(e)}" style="width:16px;height:16px;vertical-align:middle;margin-right:6px" onerror="this.style.display='none'">\n                        ${esc(e.length>30?e.slice(0,28)+"..":e)}\n                    </div>\n                `)).join("")}\n                ${(a.length||0)>12?`<div class="pl-more">+${a.length-12} more</div>`:""}\n            </div>\n        `}else if("screenshots_group"===t){const n=e.data||[];s=`\n            <div class="panel-header">\n                <div class="panel-icon screenshot">üì∑</div>\n                <div class="panel-title">Scanned Domains (${n.length})</div>\n            </div>\n            <div class="panel-screenshots">\n                ${n.slice(0,6).map((e=>`\n                    <div class="panel-thumb" onclick="openModal('${esc(e.screenshot)}', '${esc(e.domain)}')">\n                        <img src="${esc(e.screenshot)}" loading="lazy">\n                        <span>${esc(e.domain.slice(0,20))}</span>\n                    </div>\n                `)).join("")}\n            </div>\n            ${n.length>6?`<div class="pl-more">+${n.length-6} more screenshots</div>`:""}\n        `}else if("domain"===t){const n=e.data;s=`\n            <div class="node-info-content">\n                <div class="node-info-header">\n                    <div class="node-info-icon type-domain">üåê</div>\n                    <div class="node-info-title">\n                        <h3>${esc(n.domain)}</h3>\n                        <span class="node-type-badge info">Scanned Domain</span>\n                    </div>\n                </div>\n\n                ${n.screenshot?`\n                    <div class="node-screenshot-preview">\n                        <img src="${esc(n.screenshot)}" onclick="openModal('${esc(n.screenshot)}', '${esc(n.domain)}')" style="cursor:pointer">\n                    </div>\n                `:""}\n\n                <div class="node-info-section">\n                    <h4><i class="fas fa-server"></i> Domain Info</h4>\n                    <div class="node-info-row">\n                        <span class="label">Domain</span>\n                        <span class="value monospace">${esc(n.domain)}</span>\n                    </div>\n                    ${n.ip?`\n                    <div class="node-info-row">\n                        <span class="label">IP Address</span>\n                        <span class="value monospace">${esc(n.ip)}</span>\n                    </div>\n                    `:""}\n                    ${n.country?`\n                    <div class="node-info-row">\n                        <span class="label">Country</span>\n                        <span class="value">${getFlag(n.country)} ${esc(n.country.toUpperCase())}</span>\n                    </div>\n                    `:""}\n                    ${n.server?`\n                    <div class="node-info-row">\n                        <span class="label">Server</span>\n                        <span class="value">${esc(n.server)}</span>\n                    </div>\n                    `:""}\n                    ${n.title?`\n                    <div class="node-info-row">\n                        <span class="label">Page Title</span>\n                        <span class="value">${esc(n.title.slice(0,50))}</span>\n                    </div>\n                    `:""}\n                    ${n.urlscan_uuid?`\n                    <div class="node-info-row">\n                        <span class="label">Scan ID</span>\n                        <span class="value monospace" style="font-size:10px">${esc(n.urlscan_uuid.slice(0,16))}...</span>\n                    </div>\n                    `:""}\n                </div>\n\n                <div class="node-info-actions">\n                    <a href="https://urlscan.io/search/#${encodeURIComponent(n.domain)}" target="_blank" class="btn btn-sm">URLScan</a>\n                    <a href="https://web.archive.org/web/*/${encodeURIComponent(n.domain)}" target="_blank" class="btn btn-sm btn-secondary">Archive</a>\n                </div>\n            </div>\n        `}else if("connections_group"===t){const n=e.data||[];s=`\n            <div class="panel-header">\n                <div class="panel-icon connection">üîó</div>\n                <div class="panel-title">Shared Passwords (${n.length})</div>\n            </div>\n            <p style="padding: 12px; color: var(--text-muted); font-size: 12px;">\n                These actors share the same password with this actor - likely same person or group.\n            </p>\n            <div class="panel-list">\n                ${n.slice(0,10).map((e=>{const n=DATA.emails.find((n=>n.email===e));return`<div class="pl-item connection" onclick="openProfile('${esc(e)}')" style="cursor:pointer">\n                        ${n?.google?.photo?`<img src="${esc(n.google.photo)}" style="width:20px;height:20px;border-radius:50%">`:"üìß"}\n                        ${esc(e)}\n                        ${n?.blacklist?.length?'<span style="color:var(--warning)">‚ö†Ô∏è</span>':""}\n                    </div>`})).join("")}\n                ${n.length>10?`<div class="pl-more">+${n.length-10} more</div>`:""}\n            </div>\n        `}else if("connected_email"===t){const n=e.data||{},a=n.leak_intel?.real_names?.[0]||n.google?.name||"";s=`\n            <div class="panel-header">\n                <div class="panel-avatar">${n.google?.photo?`<img src="${esc(n.google.photo)}">`:getInitial(e.email)}</div>\n                <div class="panel-identity">\n                    ${a?`<div class="panel-name">${esc(a)}</div>`:""}\n                    <div class="panel-email">${esc(e.email)}</div>\n                </div>\n            </div>\n            <p style="padding: 12px; color: var(--accent-pink); font-size: 12px;">\n                üîë Shares password with main actor\n            </p>\n            ${n.total_domains||n.blacklist?.length||n.passwords?.length?`\n                <div class="panel-stats">\n                    ${n.total_domains?`<div class="ps-item"><span>${n.total_domains}</span>Domains</div>`:""}\n                    ${n.blacklist?.length?`<div class="ps-item warning"><span>${n.blacklist.length}</span>Threats</div>`:""}\n                    ${n.passwords?.length?`<div class="ps-item"><span>${n.passwords.length}</span>Creds</div>`:""}\n                </div>\n            `:""}\n            <button class="btn-profile" onclick="openProfile('${esc(e.email)}')">View Profile</button>\n        `}else s=`\n            <div class="panel-header">\n                <div class="panel-icon">üìÑ</div>\n                <div class="panel-title">${esc(e.label||e.type)}</div>\n            </div>\n            <div class="panel-details">\n                <div class="pd-row"><span>Type</span>${esc(e.type)}</div>\n            </div>\n        `;a.innerHTML=s}function openProfile(e){const n=DATA.emails.find((n=>n.email===e));if(!n)return;const a=document.getElementById("actor-modal"),s=document.getElementById("actor-profile");if(!a||!s)return;const t=n.leak_intel?.real_names?.[0]||n.leak_info?.fullname||n.google?.name||n.contacts?.find((e=>e.name&&!e.name.includes("REDACTED")&&!e.name.includes("???")))?.name||"",i=getActorCountry(n),o=getActorScreenshots(n),r=getVTArray(n),l=getBLArray(n),c=new Set(r.map((e=>e.domain))),d=new Set(l.map((e=>e.domain))),p=dedupePhones([...n.leak_intel?.phones||[],...n.leak_info?.phone?[{phone:n.leak_info.phone,source:"Breach Data"}]:[]]);if(s.innerHTML=`\n        \x3c!-- Header --\x3e\n        <div class="profile-hero">\n            <div class="ph-bg ${r.length?"malware":l.length?"phishing":""}"></div>\n            <div class="ph-content">\n                <div class="ph-avatar">${n.google?.photo?`<img src="${esc(n.google.photo)}">`:getInitial(n.email)}</div>\n                <div class="ph-info">\n                    ${t?`<h1 class="ph-name">${esc(t)}</h1>`:""}\n                    <div class="ph-email">${esc(n.email)}</div>\n                    ${i?`<div class="ph-location">${getFlag(i)} ${i}</div>`:""}\n                    <div class="ph-badges">\n                        ${n.is_primary_target?'<span class="badge primary">Primary Target</span>':'<span class="badge related">Related</span>'}\n                        ${r.length?`<span class="badge danger">${r.length} Malware</span>`:""}\n                        ${l.length?`<span class="badge warning">${l.length} Phishing</span>`:""}\n                        ${getBrandArray(n).length?'<span class="badge brand">Brand Impersonation</span>':""}\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Quick Stats --\x3e\n        <div class="profile-stats">\n            ${n.total_domains?`<div class="pstat">${ICONS.domain}<span>${n.total_domains}</span><label>Domains</label></div>`:""}\n            ${r.length||l.length?`<div class="pstat danger">${ICONS.malware}<span>${r.length+l.length}</span><label>Threats</label></div>`:""}\n            ${n.passwords?.length?`<div class="pstat danger">${ICONS.key}<span>${n.passwords.length}</span><label>Passwords</label></div>`:""}\n            ${hasLeakData(n)?`<div class="pstat warning">${ICONS.leak}<span>${getLeakCount(n)||n.leak_info?.num_results||0}</span><label>Leaks</label></div>`:""}\n            ${p.length?`<div class="pstat">${ICONS.phone}<span>${p.length}</span><label>Phones</label></div>`:""}\n            ${dedupeIPs(n.leak_intel?.ips||[]).length?`<div class="pstat">${ICONS.ip}<span>${dedupeIPs(n.leak_intel.ips).length}</span><label>IPs</label></div>`:""}\n        </div>\n\n        <div class="profile-body">\n            \x3c!-- Google Account --\x3e\n            ${n.google?.person_id?`\n                <section class="profile-section">\n                    <h2>${ICONS.google} Google Account</h2>\n                    <div class="google-card">\n                        ${n.google.photo?`<img src="${esc(n.google.photo)}" class="gc-photo">`:""}\n                        <div class="gc-info">\n                            <div class="gc-row"><strong>Google ID:</strong> ${esc(n.google.person_id)}</div>\n                            ${n.google.name?`<div class="gc-row"><strong>Name:</strong> ${esc(n.google.name)}</div>`:""}\n                            ${n.google.services?.length?`<div class="gc-row"><strong>Services:</strong> ${n.google.services.join(", ")}</div>`:""}\n                            ${n.google.uses_android?'<div class="gc-row"><strong>Platform:</strong> Android User</div>':""}\n                        </div>\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Breach Data (leak_info) --\x3e\n            ${n.leak_info?`\n                <section class="profile-section highlight">\n                    <h2>${ICONS.leak} Breach Data Intelligence</h2>\n                    <div class="breach-data-card">\n                        ${n.leak_info.fullname?`<div class="bd-row highlight"><span class="bd-label">Real Name</span><span class="bd-value">${esc(n.leak_info.fullname)}</span></div>`:""}\n                        ${n.leak_info.nickname?`<div class="bd-row"><span class="bd-label">Nickname</span><span class="bd-value">${esc(n.leak_info.nickname)}</span></div>`:""}\n                        ${n.leak_info.phone?`<div class="bd-row highlight"><span class="bd-label">Phone</span><span class="bd-value">${n.leak_info.phone_country?getFlag(n.leak_info.phone_country.code):""} ${esc(n.leak_info.phone)}</span></div>`:""}\n                        ${n.leak_info.num_results?`<div class="bd-row"><span class="bd-label">Found in</span><span class="bd-value">${n.leak_info.num_results} breach databases</span></div>`:""}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Intelligence Data --\x3e\n            ${n.leak_intel?.real_names?.length||n.leak_intel?.phones?.length||n.leak_intel?.ips?.length?`\n                <section class="profile-section highlight">\n                    <h2>${ICONS.user} Identity Intelligence</h2>\n                    <div class="intel-grid">\n                        ${n.leak_intel.real_names?.length?`\n                            <div class="intel-card">\n                                <div class="ic-title">Real Names</div>\n                                <div class="ic-values">${n.leak_intel.real_names.map((e=>`<span class="iv-name">${esc(e)}</span>`)).join("")}</div>\n                            </div>\n                        `:""}\n                        ${n.leak_intel.phones?.length?`\n                            <div class="intel-card">\n                                <div class="ic-title">Phone Numbers</div>\n                                <div class="ic-phones">${dedupePhones(n.leak_intel.phones).filter((e=>e.phone&&!e.phone.includes("REDACTED"))).map((e=>`\n                                    <div class="ip-row">${getFlagForPhone(e)} <span>${esc(e.phone)}</span> <small>${esc(e.source||"")}</small></div>\n                                `)).join("")||'<div class="empty-text">No public phones</div>'}</div>\n                            </div>\n                        `:""}\n                        ${n.leak_intel.ips?.length?`\n                            <div class="intel-card">\n                                <div class="ic-title">IP Addresses</div>\n                                <div class="ic-ips" id="profile-ips-${esc(n.email.replace(/[^a-z0-9]/gi,""))}">${dedupeIPs(n.leak_intel.ips).slice(0,10).map((e=>renderIPRow(e))).join("")}</div>\n                            </div>\n                        `:""}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Threats --\x3e\n            ${r.length||l.length?`\n                <section class="profile-section danger">\n                    <h2>${ICONS.malware} Threat Detections</h2>\n                    <div class="threats-list">\n                        ${r.map((e=>`\n                            <div class="threat-item malware">\n                                <div class="ti-icon">${ICONS.malware}</div>\n                                <div class="ti-info">\n                                    <div class="ti-domain">${esc(e.domain)}</div>\n                                    <div class="ti-detail">${e.malicious||0} malicious / ${e.suspicious||0} suspicious detections</div>\n                                </div>\n                                <a href="https://www.virustotal.com/gui/domain/${encodeURIComponent(e.domain)}" target="_blank" class="ti-link">${ICONS.external}</a>\n                            </div>\n                        `)).join("")}\n                        ${l.map((e=>`\n                            <div class="threat-item phishing">\n                                <div class="ti-icon">${ICONS.phishing}</div>\n                                <div class="ti-info">\n                                    <div class="ti-domain">${esc(e.domain)}</div>\n                                    <div class="ti-detail">Sources: ${(e.blacklist_sources||e.sources||[]).join(", ")||"Blacklist"}</div>\n                                </div>\n                                <a href="https://urlscan.io/search/#${encodeURIComponent(e.domain)}" target="_blank" class="ti-link">${ICONS.external}</a>\n                            </div>\n                        `)).join("")}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Brand Impersonation --\x3e\n            ${getBrandArray(n).length?`\n                <section class="profile-section warning">\n                    <h2>${ICONS.brand} Brand Impersonation</h2>\n                    <div class="brand-tags">${getBrandArray(n).map((e=>`<span class="brand-tag">${esc(e)}</span>`)).join("")}</div>\n                </section>\n            `:""}\n\n            \x3c!-- WHOIS Contacts --\x3e\n            ${n.contacts?.length?`\n                <section class="profile-section">\n                    <h2>${ICONS.user} WHOIS Contacts</h2>\n                    <div class="contacts-grid">\n                        ${dedupeContacts(n.contacts).slice(0,8).map((e=>`\n                            <div class="contact-card">\n                                <div class="cc-name">${esc(e.name||"Unknown")}${e.count>1?` <span class="cc-count">√ó${e.count}</span>`:""}</div>\n                                ${e.company?`<div class="cc-row">${esc(e.company)}</div>`:""}\n                                ${e.phone&&"REDACTED FOR PRIVACY"!==e.phone?`<div class="cc-row">${e.phone_country?getFlag(e.phone_country.code):""} ${esc(e.phone)}</div>`:""}\n                                ${e.country?`<div class="cc-row">${getFlag(e.country)} ${esc(e.country)}</div>`:""}\n                                ${e.address?`<div class="cc-row small">${esc(e.address)}</div>`:""}\n                            </div>\n                        `)).join("")}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Leaked Credentials --\x3e\n            ${n.passwords?.length?`\n                <section class="profile-section">\n                    <h2>${ICONS.key} Leaked Credentials (${n.passwords.length})</h2>\n                    <div class="creds-list">\n                        ${(()=>{const e={};return n.passwords.forEach((n=>{const a="string"==typeof n?n:n.password||"",s="object"==typeof n?(n.url||"").replace(/^www\./,"").split("/")[0]:"unknown";e[s]||(e[s]=[]),e[s].includes(a)||e[s].push(a)})),Object.entries(e).slice(0,20).map((([e,n])=>`\n                                <div class="cred-row">\n                                    <span class="cr-service">${esc(e.slice(0,30))}</span>\n                                    <div class="cr-passwords">${n.slice(0,3).map((e=>`<code>${esc(e)}</code>`)).join("")}${n.length>3?`<span class="cr-more">+${n.length-3}</span>`:""}</div>\n                                </div>\n                            `)).join("")})()}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Leak Databases --\x3e\n            ${n.leak_extended?.databases?.length?`\n                <section class="profile-section">\n                    <h2>${ICONS.leak} Data Breaches (${n.leak_extended.databases.length})</h2>\n                    <div class="leaks-grid">\n                        ${n.leak_extended.databases.slice(0,20).map((e=>{const n=parseLeakInfo(e.info||""),a=e.database||e.source||e.name||"",s=n.FirstName||n.LastName||n.Phone||n.Address||n.City||n.CompanyName||n.Password;return a&&"Unknown"!==a||s?`\n                                <div class="leak-card ${s?"has-data":""}">\n                                    <div class="lc-header">${esc(a||"Data Breach")}</div>\n                                    ${s?`<div class="lc-data">\n                                        ${n.FirstName||n.LastName?`<div class="ld-row highlight"><span>Name</span>${esc((n.FirstName||"")+" "+(n.LastName||"")).trim()}</div>`:""}\n                                        ${n.NickName?`<div class="ld-row"><span>Nick</span>${esc(n.NickName)}</div>`:""}\n                                        ${n.Phone?`<div class="ld-row highlight"><span>Phone</span>${esc(n.Phone)}</div>`:""}\n                                        ${n.Address?`<div class="ld-row highlight"><span>Addr</span>${esc(n.Address)}</div>`:""}\n                                        ${n.City?`<div class="ld-row"><span>City</span>${esc(n.City)}${n.Country?", "+esc(n.Country):""}</div>`:""}\n                                        ${n.CompanyName?`<div class="ld-row highlight"><span>Company</span>${esc(n.CompanyName)}</div>`:""}\n                                        ${n.Domain?`<div class="ld-row"><span>Domain</span>${esc(n.Domain)}</div>`:""}\n                                        ${n.IP?`<div class="ld-row"><span>IP</span>${esc(n.IP)}</div>`:""}\n                                        ${n.Password?`<div class="ld-row danger"><span>Pass</span><code>${esc(n.Password)}</code></div>`:""}\n                                        ${n["Password(MD5)"]?`<div class="ld-row"><span>Hash</span><code class="hash">${esc(n["Password(MD5)"].slice(0,16))}...</code></div>`:""}\n                                    </div>`:'<div class="lc-empty">Email found in breach</div>'}\n                                </div>\n                            `:""})).join("")}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Screenshots --\x3e\n            ${o.length?`\n                <section class="profile-section">\n                    <h2>${ICONS.screenshot} Site Screenshots (${o.length})</h2>\n                    <div class="screenshots-grid">\n                        ${o.slice(0,12).map((e=>{const n=c.has(e.domain),a=d.has(e.domain);return`\n                                <div class="screenshot-card ${n?"malware":""} ${a?"phishing":""}" onclick="openModal('${esc(e.screenshot)}', '${esc(e.domain)}')">\n                                    <img src="${esc(e.screenshot)}" loading="lazy">\n                                    <div class="sc-overlay">\n                                        ${n?'<span class="sc-badge danger">MAL</span>':""}\n                                        ${a?'<span class="sc-badge warning">PHISH</span>':""}\n                                    </div>\n                                    <div class="sc-domain">${esc(e.domain)}</div>\n                                </div>\n                            `})).join("")}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- Domain Registrars --\x3e\n            ${n.registrars?.length?`\n                <section class="profile-section">\n                    <h2>üè¢ Domain Registrars (${n.registrars.length})</h2>\n                    <div class="registrars-list">\n                        ${n.registrars.slice(0,10).map((e=>`<span class="registrar-tag">${esc(e)}</span>`)).join("")}\n                    </div>\n                </section>\n            `:""}\n\n            \x3c!-- All Domains --\x3e\n            ${n.domains?.length?`\n                <section class="profile-section">\n                    <h2>${ICONS.domain} All Domains (${n.total_domains||n.domains.length})</h2>\n                    <div class="domains-list">\n                        ${n.domains.slice(0,50).map((e=>`<span class="domain-tag ${c.has(e)?"malware":""} ${d.has(e)?"phishing":""}">${esc(e)}</span>`)).join("")}\n                        ${n.domains.length>50?`<span class="domains-more">+${n.domains.length-50} more</span>`:""}\n                    </div>\n                </section>\n            `:""}\n        </div>\n    `,a.classList.add("active"),n.leak_intel?.ips?.length){const e=dedupeIPs(n.leak_intel.ips).slice(0,10),a=e.map((e=>e.ip)).filter((e=>!ipCache.has(e)));a.length&&lookupIPsBatch(a).then((()=>{const a=`profile-ips-${n.email.replace(/[^a-z0-9]/gi,"")}`,s=document.getElementById(a);s&&(s.innerHTML=e.map((e=>renderIPRow(e))).join(""))}))}}function closeActorModal(){document.getElementById("actor-modal")?.classList.remove("active")}function openModal(e,n){if(!e)return;const a=document.getElementById("modal"),s=document.getElementById("modal-image"),t=document.getElementById("modal-info");a&&s&&(s.src=e,t&&(t.textContent=n||""),a.classList.add("active"))}function closeModal(){document.getElementById("modal")?.classList.remove("active")}function renderPagination(){const e=Math.ceil(filtered.length/perPage),n=document.getElementById("pagination");!n||e<=1?n&&(n.innerHTML=""):n.innerHTML=`\n        <button ${1===page?"disabled":""} onclick="changePage(${page-1})">Previous</button>\n        <span>Page ${page} of ${e}</span>\n        <button ${page===e?"disabled":""} onclick="changePage(${page+1})">Next</button>\n    `}function changePage(e){page=e,renderActors(),window.scrollTo({top:0,behavior:"smooth"})}window.selectGraphActor=selectGraphActor,window.openProfile=openProfile,window.closeActorModal=closeActorModal,window.openModal=openModal,window.closeModal=closeModal,window.changePage=changePage;const GEO_SOURCES={alfabank:"ru",alfaBank:"ru",sberbank:"ru",tinkoff:"ru",vtb:"ru",gazprombank:"ru",rosbank:"ru",otkritie:"ru",sovcombank:"ru","pochta.ru":"ru",cdek:"ru",boxberry:"ru","dpd.ru":"ru",pek:"ru",wildberries:"ru",ozon:"ru","dns-shop":"ru",mvideo:"ru",eldorado:"ru",citilink:"ru",svyaznoy:"ru","metro-cc.ru":"ru",lenta:"ru",perekrestok:"ru",magnit:"ru",pyaterochka:"ru",dixy:"ru",yandex:"ru","mail.ru":"ru",rambler:"ru",gosuslugi:"ru","nalog.ru":"ru","pfr.ru":"ru","mos.ru":"ru",avito:"ru",youla:"ru","drom.ru":"ru","auto.ru":"ru","hh.ru":"ru","superjob.ru":"ru","rabota.ru":"ru","fonbet.ru":"ru",ligastavok:"ru",adengi:"ru",oneclickmoney:"ru","moneyman.ru":"ru","vivus.ru":"ru",zaimer:"ru",mts:"ru",megafon:"ru",beeline:"ru",tele2:"ru",yota:"ru",rostelecom:"ru","vk.com":"ru",vkontakte:"ru","ok.ru":"ru",pikabu:"ru",habr:"ru","vc.ru":"ru",dtf:"ru",kinopoisk:"ru",ivi:"ru",okko:"ru",amediateka:"ru",sportmaster:"ru","decathlon.ru":"ru","rendez-vous":"ru",privatbank:"ua",privat24:"ua",monobank:"ua",oschadbank:"ua","nova poshta":"ua",novaposhta:"ua",ukrposhta:"ua",meest:"ua",rozetka:"ua",epicentr:"ua",comfy:"ua",foxtrot:"ua","allo.ua":"ua",silpo:"ua",atb:"ua",fozzy:"ua",novus:"ua","metro.ua":"ua","olx.ua":"ua","work.ua":"ua","rabota.ua":"ua","dou.ua":"ua","jobs.ua":"ua",kyivstar:"ua","vodafone.ua":"ua",lifecell:"ua",yavshoke:"ua","yavshoke.ua":"ua","prom.ua":"ua","hotline.ua":"ua","ria.ua":"ua","auto.ria":"ua","ukr.net":"ua","i.ua":"ua","meta.ua":"ua",bigmir:"ua",diia:"ua","action.gov.ua":"ua",volia:"ua",triolan:"ua",datagroup:"ua",belarusbank:"by",priorbank:"by","alfa.by":"by",euroopt:"by","e-dostavka":"by","21vek":"by",onliner:"by",kaspi:"kz",halyk:"kz",forte:"kz",jusan:"kz","kolesa.kz":"kz","krisha.kz":"kz","olx.kz":"kz",uber:"us",lyft:"us",doordash:"us",instacart:"us",grubhub:"us",venmo:"us",cashapp:"us",zelle:"us",paypal:"us",chase:"us",wellsfargo:"us",bankofamerica:"us",citi:"us","amazon.com":"us",walmart:"us",target:"us",bestbuy:"us",linkedin:"us",facebook:"us",instagram:"us",twitter:"us",revolut:"gb",n26:"de",klarna:"se",ing:"nl"},ANDROID_INDICATORS=["Photos","Maps","Meet","Drive","Play","Chrome","Gmail","Youtube"];function getActorCountry(e){const n={};function a(e,a=1){if(e){const s=e.toLowerCase().trim(),t={ukraine:"ua",ua:"ua",russia:"ru","russian federation":"ru",ru:"ru",belarus:"by",by:"by",kazakhstan:"kz",kz:"kz","united states":"us",usa:"us",us:"us"}[s]||s;t&&2===t.length&&(n[t]=(n[t]||0)+a)}}e.contacts?.length&&e.contacts.forEach((e=>{e.country&&a(e.country,5)}));dedupePhones(e.leak_intel?.phones||[]).forEach((e=>{const n=getCountryFromPhone(e.phone);n&&a(n,4)}));const s=[];e.leak_extended?.databases&&e.leak_extended.databases.forEach((e=>{e.database&&s.push(e.database),e.source&&s.push(e.source)})),e.leak_intel?.phones&&e.leak_intel.phones.forEach((e=>e.source&&s.push(e.source))),e.leak_intel?.ips&&e.leak_intel.ips.forEach((e=>e.source&&s.push(e.source))),s.forEach((e=>{const n=e.toLowerCase();n.includes(".ua")||n.includes("_ua")?a("ua",3):n.includes(".ru")||n.includes("_ru")?a("ru",3):n.includes(".by")||n.includes("_by")?a("by",3):(n.includes(".kz")||n.includes("_kz"))&&a("kz",3)}));for(const e of s){const n=e.toLowerCase().replace(/[\s_\-]/g,"");for(const[e,s]of Object.entries(GEO_SOURCES))n.includes(e.toLowerCase().replace(/[\s_\-]/g,""))&&a(s,2)}if(e.leak_intel?.ips?.length&&e.leak_intel.ips.forEach((e=>{const n=ipCache.get(e.ip);if(n?.country&&a(n.country,2),e.source){const n=e.source.toLowerCase();(n.includes("volia")||n.includes("kharkov")||n.includes("kharkiv")||n.includes("kyiv")||n.includes("kiev")||n.includes("triolan")||n.includes("ukr")||n.includes("datagroup"))&&a("ua",3)}})),e.user_geo?.countries?.[0]&&a(e.user_geo.countries[0],1),e.domain_cards?.[0]?.country&&a(e.domain_cards[0].country,1),Object.keys(n).length){return Object.entries(n).sort(((e,n)=>n[1]-e[1]))[0][0]}return""}function hasAndroid(e){return!!e.google?.uses_android||(!!e.google?.android_services?.length||!!e.google?.services?.some((e=>ANDROID_INDICATORS.includes(e))))}function getActorServices(e){const n=[];return e.google?.services?.length&&n.push(...e.google.services),[...new Set(n)]}function getPhishingSources(e){if(!e?.length)return{icon:ICONS.phishing,text:"Unknown"};const n=new Set;e.forEach((e=>{e.sources&&e.sources.forEach((e=>n.add(e)))}));const a=[...n];return a.includes("MetaMask")?{icon:ICONS.metamask,text:a.join(", ")}:a.includes("SEAL")?{icon:ICONS.seal,text:a.join(", ")}:{icon:ICONS.phishing,text:a.join(", ")||"Blacklist"}}function getRegistrar(e){if(!e?.whois)return null;const n=e.whois;return n.registrar||n.Registrar||null}const ipCache=new Map;async function lookupIP(e){if(!e)return null;if(ipCache.has(e))return ipCache.get(e);try{const n=await fetch(`http://ip-api.com/json/${e}?fields=status,country,countryCode,isp,org,mobile,proxy,hosting`),a=await n.json();if("success"===a.status){const n={ip:e,country:a.countryCode?.toLowerCase(),countryName:a.country,isp:a.isp,org:a.org,isMobile:a.mobile,isProxy:a.proxy||a.hosting,isHosting:a.hosting,loaded:!0};return ipCache.set(e,n),n}}catch(n){console.warn("IP lookup failed:",e,n)}const n={ip:e,loaded:!1};return ipCache.set(e,n),n}async function lookupIPsBatch(e){const n=e.filter((e=>!ipCache.has(e))).slice(0,100);if(n.length)try{const e=await fetch("http://ip-api.com/batch?fields=status,query,country,countryCode,isp,org,mobile,proxy,hosting",{method:"POST",body:JSON.stringify(n.map((e=>({query:e}))))});(await e.json()).forEach((e=>{"success"===e.status&&ipCache.set(e.query,{ip:e.query,country:e.countryCode?.toLowerCase(),countryName:e.country,isp:e.isp,org:e.org,isMobile:e.mobile,isProxy:e.proxy||e.hosting,isHosting:e.hosting,loaded:!0})}))}catch(e){console.warn("Batch IP lookup failed:",e)}}function getIPInfo(e){return ipCache.get(e)||{ip:e,loaded:!1}}function renderIPRow(e,n=!0){const a=e.ip||e,s=e.source||"",t=getIPInfo(a);let i="",o="",r="";return t.loaded?(t.country&&(r=`<span class="fi fi-${t.country}"></span>`),i=t.isProxy||t.isHosting?'<span class="ip-tag proxy">Proxy/VPN</span>':t.isMobile?'<span class="ip-tag mobile">Mobile</span>':'<span class="ip-tag residential">Residential</span>',t.isp&&(o=`<span class="ip-isp">${esc(t.isp)}</span>`)):i='<span class="ip-tag loading">...</span>',`<div class="ip-row" data-ip="${esc(a)}">\n        ${r}\n        ${i}\n        <code>${esc(a)}</code>\n        ${o}\n        ${n&&s?`<small class="ip-source">${esc(s)}</small>`:""}\n    </div>`}function getInitial(e){return(e||"U")[0].toUpperCase()}function getCountryEmoji(e){if(!e||2!==e.length)return"";return String.fromCodePoint(...e.toUpperCase().split("").map((e=>e.charCodeAt(0)+127397)))}function getFlag(e){if(!e)return"";let n=e.toLowerCase().trim();return n={nigeria:"ng","united states":"us",usa:"us","united kingdom":"gb",uk:"gb",germany:"de",france:"fr",spain:"es",italy:"it",netherlands:"nl",russia:"ru","russian federation":"ru",china:"cn",japan:"jp",india:"in",brazil:"br",canada:"ca",australia:"au","south africa":"za",ghana:"gh",kenya:"ke",singapore:"sg","hong kong":"hk",malaysia:"my",indonesia:"id",philippines:"ph",turkey:"tr",poland:"pl",ukraine:"ua",romania:"ro",czech:"cz","czech republic":"cz",sweden:"se",norway:"no",denmark:"dk",finland:"fi",ireland:"ie",switzerland:"ch",austria:"at",belgium:"be",portugal:"pt",greece:"gr",mexico:"mx",argentina:"ar",colombia:"co",chile:"cl",peru:"pe",egypt:"eg",morocco:"ma",uae:"ae","united arab emirates":"ae","saudi arabia":"sa",israel:"il",pakistan:"pk",bangladesh:"bd",vietnam:"vn",thailand:"th",korea:"kr","south korea":"kr",taiwan:"tw","new zealand":"nz",kazakhstan:"kz",belarus:"by",uzbekistan:"uz",georgia:"ge",armenia:"am",azerbaijan:"az",moldova:"md",latvia:"lv",lithuania:"lt",estonia:"ee"}[n]||(2===n.length?n:""),n?`<span class="fi fi-${n}"></span>`:""}function getCountryFromPhone(e){if(!e)return null;const n=String(e).replace(/\D/g,"");if(!n||n.length<10)return null;if(n.startsWith("7")&&11===n.length){return"7"===n[1]?"kz":"ru"}if(n.startsWith("8")&&11===n.length)return"ru";if(n.startsWith("380")&&12===n.length)return"ua";if(n.startsWith("375")&&12===n.length)return"by";if(n.startsWith("1")&&11===n.length)return"us";const a=[["998","uz"],["995","ge"],["994","az"],["374","am"],["373","md"],["371","lv"],["370","lt"],["372","ee"],["234","ng"],["233","gh"],["254","ke"],["212","ma"],["971","ae"],["966","sa"],["972","il"],["880","bd"],["351","pt"],["358","fi"],["353","ie"],["420","cz"],["421","sk"],["386","si"],["385","hr"],["381","rs"],["359","bg"],["44","gb"],["49","de"],["33","fr"],["39","it"],["34","es"],["31","nl"],["48","pl"],["40","ro"],["90","tr"],["86","cn"],["81","jp"],["82","kr"],["91","in"],["55","br"],["52","mx"],["27","za"],["20","eg"],["92","pk"],["84","vn"],["66","th"],["62","id"],["60","my"],["63","ph"],["65","sg"],["61","au"],["64","nz"],["41","ch"],["43","at"],["32","be"],["30","gr"],["46","se"],["47","no"],["45","dk"],["36","hu"]];for(const[e,s]of a)if(n.startsWith(e))return s;return null}function getFlagForPhone(e){if(e?.country?.code)return getFlag(e.country.code);const n=getCountryFromPhone("string"==typeof e?e:e?.phone);return n?`<span class="fi fi-${n}"></span>`:""}function dedupePhones(e){if(!e||!e.length)return[];const n=new Set;return e.filter((e=>{const a=String(e.phone||e).replace(/\D/g,"");return!n.has(a)&&(n.add(a),!0)}))}function dedupeIPs(e){if(!e||!e.length)return[];const n=new Set;return e.filter((e=>{const a=e.ip||e;return!n.has(a)&&(n.add(a),!0)}))}function dedupeContacts(e){if(!e||!e.length)return[];const n=new Map;return e.forEach((e=>{const a=`${(e.name||"").toLowerCase().trim()}|${(e.phone||"").replace(/\D/g,"")}|${(e.address||"").toLowerCase().trim()}`;if(n.has(a)){const s=n.get(a);s.count++,!s.company&&e.company&&(s.company=e.company),!s.country&&e.country&&(s.country=e.country)}else n.set(a,{...e,count:1})})),[...n.values()]}function getFavicon(e){return`https://www.google.com/s2/favicons?domain=${e}&sz=32`}function fmt(e){return(e||0).toLocaleString()}function setText(e,n){const a=document.getElementById(e);a&&(a.textContent=n)}function esc(e){if(!e)return"";const n=document.createElement("div");return n.textContent=e,n.innerHTML}function debounce(e,n){let a;return(...s)=>{clearTimeout(a),a=setTimeout((()=>e(...s)),n)}}function parseLeakInfo(e){const n={};if(!e)return n;const a=e.split(";");for(const e of a){const a=e.indexOf(":");if(a>0){const s=e.slice(0,a).trim(),t=e.slice(a+1).trim();s&&t&&(n[s]=t)}}return n}let allThreats=[];function populateRegistrarFilter(){const e=document.getElementById("threat-registrar-filter");e&&window.threatRegistrars&&(e.innerHTML='<option value="all">All Registrars</option>',window.threatRegistrars.forEach((n=>{e.innerHTML+=`<option value="${esc(n)}">${esc(n.slice(0,40))}</option>`})))}function filterThreats(){const e=document.getElementById("threats-container"),n=document.getElementById("threats-stats");if(!e)return;const a=document.getElementById("threat-type-filter")?.value||"all",s=document.getElementById("threat-registrar-filter")?.value||"all",t=document.getElementById("threat-sort")?.value||"severity";let i=[...allThreats];if("all"!==a&&(i=i.filter((e=>e.type===a))),"all"!==s&&(i=i.filter((e=>e.registrar===s))),"severity"===t?i.sort(((e,n)=>n.severity-e.severity)):"date"===t?i.sort(((e,n)=>{const a=e.created?new Date(e.created):new Date(0);return(n.created?new Date(n.created):new Date(0))-a})):"registrar"===t&&i.sort(((e,n)=>(e.registrar||"zzz").localeCompare(n.registrar||"zzz"))),n){const e=i.filter((e=>"malware"===e.type)).length,a=i.filter((e=>"phishing"===e.type)).length,s=new Set(i.filter((e=>e.registrar)).map((e=>e.registrar))).size;n.innerHTML=`\n            <div class="ts-item danger"><span>${e}</span>Malware</div>\n            <div class="ts-item warning"><span>${a}</span>Phishing</div>\n            <div class="ts-item"><span>${s}</span>Registrars</div>\n            <div class="ts-item"><span>${i.length}</span>Total</div>\n        `}i.length?e.innerHTML=i.map(((e,n)=>{const a=e.actor.leak_intel?.real_names?.[0]||"",s="malware"===e.type?ICONS.virustotal:e.sources?.includes("MetaMask")?ICONS.metamask:e.sources?.includes("SEAL")?ICONS.seal:ICONS.phishing,t="malware"===e.type?"VirusTotal":e.sources?.slice(0,2).join(", ")||"Blacklist";return`\n            <div class="domain-threat ${e.type}" style="animation-delay: ${.05*n}s" onclick="openProfile('${esc(e.actor.email)}')">\n                <div class="dt-visual ${e.screenshot?"":"no-screenshot"}" onclick="event.stopPropagation(); ${e.screenshot?`openModal('${esc(e.screenshot)}', '${esc(e.domain)}')`:""}">\n                    ${e.screenshot?`<img src="${esc(e.screenshot)}" loading="lazy" onerror="this.parentElement.classList.add('no-screenshot'); this.nextElementSibling.style.display='flex'; this.remove();">\n                         <div class="dt-no-img" style="display:none"><span>No Preview</span></div>`:'<div class="dt-no-img"><span>No Preview</span></div>'}\n                    <div class="dt-badges">\n                        <span class="dt-type ${e.type}">${e.type.toUpperCase()}</span>\n                        <span class="dt-source">${s} ${t}</span>\n                    </div>\n                    ${"malware"===e.type&&e.detections?`<span class="dt-detections">${e.detections}/${e.total||70}</span>`:""}\n                    <div class="dt-overlay"><span>View Screenshot</span></div>\n                </div>\n                <div class="dt-info">\n                    <div class="dt-domain">\n                        <img src="${getFavicon(e.domain)}" onerror="this.style.display='none'">\n                        <span>${esc(e.domain)}</span>\n                    </div>\n                    ${e.country||e.ip?`<div class="dt-location">${e.country?getFlag(e.country):""} ${e.ip||""}</div>`:""}\n                    ${e.registrar?`<div class="dt-registrar">${ICONS.domain} ${esc(e.registrar.slice(0,35))}</div>`:""}\n                    ${e.created?`<div class="dt-created">${ICONS.link} ${esc(formatDate(e.created))}</div>`:""}\n                    <div class="dt-actor">\n                        ${e.actor.google?.photo?`<img src="${esc(e.actor.google.photo)}" onerror="this.remove()">`:`<span class="dt-actor-initial">${getInitial(e.actor.email)}</span>`}\n                        <span>${a?esc(a)+" ¬∑ ":""}${esc(e.actor.email)}</span>\n                    </div>\n                    <div class="dt-actions" onclick="event.stopPropagation()">\n                        <a href="https://www.virustotal.com/gui/domain/${encodeURIComponent(e.domain)}" target="_blank" class="btn-sm">${ICONS.virustotal} VT</a>\n                        <a href="https://urlscan.io/search/#${encodeURIComponent(e.domain)}" target="_blank" class="btn-sm">${ICONS.screenshot} Scan</a>\n                    </div>\n                </div>\n            </div>\n        `})).join(""):e.innerHTML='<div class="empty-state"><h3>No threats match filters</h3></div>'}function formatDate(e){if(!e)return"";try{const n=new Date(e);return isNaN(n.getTime())?e:n.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return e}}window.filterThreats=filterThreats,document.addEventListener("keydown",(e=>{"Escape"===e.key&&(closeModal(),closeActorModal())}));